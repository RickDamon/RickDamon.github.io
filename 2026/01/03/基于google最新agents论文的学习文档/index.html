<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="åŸºäºGoogleæœ€æ–°Agentsè®ºæ–‡çš„å­¦ä¹ æ–‡æ¡£, programming,learning,blog">
    <meta name="description" content="å¯¼è¯­åŸé“¾æ¥ï¼šGoogle AI Agents Technical Guide
è¿™ä»½ç™½çš®ä¹¦æ˜¯ Google å¯¹AI Agent ä»æ¦‚å¿µåˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŠ€æœ¯è·¯çº¿å›¾ï¼Œæ¶µç›–äº†ï¼š

âœ… AI Agent çš„å®šä¹‰å’Œåˆ†ç±»
âœ… Agent å¼€å‘æ¡†æ¶ï¼ˆADK">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>åŸºäºGoogleæœ€æ–°Agentsè®ºæ–‡çš„å­¦ä¹ æ–‡æ¡£ | RickDamon&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 8.1.1"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/image.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">RickDamon&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="æ·±è‰²/æµ…è‰²æ¨¡å¼" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/image.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">RickDamon&#39;s Blog</div>
        <div class="logo-desc">
            
            Personal blog about programming, learning, and life
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/14.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">åŸºäºGoogleæœ€æ–°Agentsè®ºæ–‡çš„å­¦ä¹ æ–‡æ¡£</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/AI-Agents/">
                                <span class="chip bg-color">AI Agents</span>
                            </a>
                        
                            <a href="/tags/LLM/">
                                <span class="chip bg-color">LLM</span>
                            </a>
                        
                            <a href="/tags/ADK%E6%A1%86%E6%9E%B6/">
                                <span class="chip bg-color">ADKæ¡†æ¶</span>
                            </a>
                        
                            <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">
                                <span class="chip bg-color">ç³»ç»Ÿè®¾è®¡</span>
                            </a>
                        
                            <a href="/tags/%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2/">
                                <span class="chip bg-color">ç”Ÿäº§éƒ¨ç½²</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/AI/" class="post-category">
                                AI
                            </a>
                        
                            <a href="/categories/AI/Agent/" class="post-category">
                                Agent
                            </a>
                        
                            <a href="/categories/AI/Agent/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" class="post-category">
                                æ¶æ„è®¾è®¡
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2026-01-03
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="å¯¼è¯­"><a href="#å¯¼è¯­" class="headerlink" title="å¯¼è¯­"></a>å¯¼è¯­</h2><p>åŸé“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://services.google.com/fh/files/misc/startup_technical_guide_ai_agents_final.pdf">Google AI Agents Technical Guide</a></p>
<p>è¿™ä»½ç™½çš®ä¹¦æ˜¯ Google å¯¹AI Agent ä»æ¦‚å¿µåˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŠ€æœ¯è·¯çº¿å›¾ï¼Œæ¶µç›–äº†ï¼š</p>
<ol>
<li>âœ… AI Agent çš„å®šä¹‰å’Œåˆ†ç±»</li>
<li>âœ… Agent å¼€å‘æ¡†æ¶ï¼ˆADKï¼‰</li>
<li>âœ… ä¼ä¸šçº§æ™ºèƒ½ä½“çš„æ¶æ„è®¾è®¡</li>
<li>âœ… ä»å®éªŒå®¤åˆ°ç”Ÿäº§çš„æŠ€æœ¯è½¬åŒ–</li>
<li>âœ… æœ€ä½³å®è·µå’Œæ¡ˆä¾‹ç ”ç©¶</li>
</ol>
<p>Googleé€‰æ‹©ç”¨ADK å››å±‚æ¶æ„ï¼ˆLLM + Tool + Memory + Orchestrationï¼‰æ¥ç³»ç»Ÿåœ°ç»„ç»‡å’Œç®¡ç† Agent çš„å„ä¸ªå…³é”®ç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿåè°ƒå·¥ä½œï¼Œå¯¹å½“å‰ç›¸å¯¹è¿˜ç®—æ··ä¹±çš„Agentå·¥ç¨‹æœ‰ä¸€å®šçš„å‚è€ƒæ„ä¹‰ã€‚</p>
<span id="more"></span>

<hr>
<h1 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µ"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µ" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µ"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µ</h1><h2 id="ä»€ä¹ˆæ˜¯-AI-Agent"><a href="#ä»€ä¹ˆæ˜¯-AI-Agent" class="headerlink" title="ä»€ä¹ˆæ˜¯ AI Agent"></a>ä»€ä¹ˆæ˜¯ AI Agent</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><strong>AI Agent</strong> æ˜¯ä¸€ä¸ªè‡ªä¸»çš„è½¯ä»¶ç³»ç»Ÿï¼Œèƒ½å¤Ÿï¼š</p>
<ul>
<li>ğŸ“ <strong>æ„ŸçŸ¥</strong>ç¯å¢ƒçŠ¶æ€</li>
<li>ğŸ§  <strong>ç†è§£</strong>ç”¨æˆ·æ„å›¾</li>
<li>ğŸ¤” <strong>åˆ¶å®š</strong>è¡ŒåŠ¨è®¡åˆ’</li>
<li>âš¡ <strong>æ‰§è¡Œ</strong>å…·ä½“æ“ä½œ</li>
<li>ğŸ“Š <strong>è¯„ä¼°</strong>æ‰§è¡Œç»“æœ</li>
<li>ğŸ”„ <strong>åé¦ˆ</strong>è°ƒæ•´ç­–ç•¥</li>
</ul>
<h3 id="åŸºæœ¬å¾ªç¯"><a href="#åŸºæœ¬å¾ªç¯" class="headerlink" title="åŸºæœ¬å¾ªç¯"></a>åŸºæœ¬å¾ªç¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ„ŸçŸ¥ (Perceive) â†’ æ€è€ƒ (Think) â†’ è¡ŒåŠ¨ (Act) â†’ åæ€ (Reflect) â†’ å¾ªç¯</span><br></pre></td></tr></table></figure>

<p>ä¸ä¼ ç»Ÿç¨‹åºçš„å¯¹æ¯”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¼ ç»Ÿç¨‹åºï¼šè¾“å…¥ â†’ å¤„ç† â†’ è¾“å‡ºï¼ˆä¸€æ¬¡æ€§æ‰§è¡Œï¼‰</span><br><span class="line"></span><br><span class="line">AI Agentï¼šç”¨æˆ·æ„å›¾ â†’ ç†è§£ â†’ è§„åˆ’ â†’ æ‰§è¡Œ â†’ ç›‘æ§ â†’ ä¼˜åŒ–ï¼ˆæŒç»­å¾ªç¯ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="Agent-çš„æ ¸å¿ƒç‰¹æ€§"><a href="#Agent-çš„æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="Agent çš„æ ¸å¿ƒç‰¹æ€§"></a>Agent çš„æ ¸å¿ƒç‰¹æ€§</h2><h3 id="1-è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰"><a href="#1-è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰" class="headerlink" title="1. è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰"></a>1. è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰</h3><p>Agent èƒ½å¤Ÿåœ¨æ²¡æœ‰å¤–éƒ¨å¹²é¢„çš„æƒ…å†µä¸‹ç‹¬ç«‹å®Œæˆä»»åŠ¡ã€‚</p>
<p>ç¤ºä¾‹ï¼šè®¢å•å¤„ç† Agent</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éè‡ªä¸»ç³»ç»Ÿ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_order</span>(<span class="params">order_id</span>):</span><br><span class="line">    order = get_order(order_id)</span><br><span class="line">    <span class="keyword">if</span> order.status == <span class="string">&quot;unpaid&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è®¢å•æœªæ”¯ä»˜ï¼Œè¯·äººå·¥å¤„ç†&quot;</span>)  <span class="comment"># åœæ»</span></span><br><span class="line">    <span class="keyword">return</span> order</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªä¸» Agent</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">autonomous_order_agent</span>(<span class="params">order_id</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        order = get_order(order_id)</span><br><span class="line">        <span class="keyword">if</span> order.status == <span class="string">&quot;unpaid&quot;</span>:</span><br><span class="line">            <span class="comment"># è‡ªä¸»æ£€æŸ¥ç”¨æˆ·ä½™é¢</span></span><br><span class="line">            balance = check_user_balance(order.user_id)</span><br><span class="line">            <span class="keyword">if</span> balance &gt;= order.amount:</span><br><span class="line">                <span class="comment"># è‡ªä¸»å‘èµ·æ”¯ä»˜</span></span><br><span class="line">                payment_result = process_payment(order)</span><br><span class="line">                <span class="keyword">if</span> payment_result.success:</span><br><span class="line">                    update_order_status(order_id, <span class="string">&quot;paid&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># è‡ªä¸»å‘é€æé†’</span></span><br><span class="line">                send_reminder(order.user_id, <span class="string">&quot;ä½™é¢ä¸è¶³&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">3600</span>)  <span class="comment"># æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ååº”æ€§ï¼ˆResponsivenessï¼‰"><a href="#2-ååº”æ€§ï¼ˆResponsivenessï¼‰" class="headerlink" title="2. ååº”æ€§ï¼ˆResponsivenessï¼‰"></a>2. ååº”æ€§ï¼ˆResponsivenessï¼‰</h3><p>Agent èƒ½å¤ŸåŠæ—¶å¯¹ç¯å¢ƒå˜åŒ–åšå‡ºå“åº”ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å®æ—¶æ„ŸçŸ¥äº‹ä»¶</li>
<li>å¿«é€Ÿå†³ç­–</li>
<li>ç«‹å³æ‰§è¡Œå“åº”</li>
</ul>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ResponsiveAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.event_queue = asyncio.Queue()</span><br><span class="line">        <span class="variable language_">self</span>.handlers = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">on_user_message</span>(<span class="params">self, message: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å®æ—¶å¤„ç†ç”¨æˆ·æ¶ˆæ¯&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.event_queue.put(&#123;</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;user_message&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: message,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">process_events</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŒç»­å¤„ç†äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            event = <span class="keyword">await</span> <span class="variable language_">self</span>.event_queue.get()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç«‹å³å“åº”</span></span><br><span class="line">            handler = <span class="variable language_">self</span>.handlers.get(event[<span class="string">&#x27;type&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> handler:</span><br><span class="line">                response = <span class="keyword">await</span> handler(event[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.send_response(response)</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.event_queue.task_done()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_response</span>(<span class="params">self, response: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å®æ—¶å‘é€å“åº”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Agent å›å¤: <span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-ä¸»åŠ¨æ€§ï¼ˆProactivenessï¼‰"><a href="#3-ä¸»åŠ¨æ€§ï¼ˆProactivenessï¼‰" class="headerlink" title="3. ä¸»åŠ¨æ€§ï¼ˆProactivenessï¼‰"></a>3. ä¸»åŠ¨æ€§ï¼ˆProactivenessï¼‰</h3><p>Agent ä¸ä»…è¢«åŠ¨å“åº”ï¼Œè¿˜èƒ½ä¸»åŠ¨é‡‡å–è¡ŒåŠ¨ã€‚</p>
<p>vs è¢«åŠ¨å¼ç³»ç»Ÿï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¢«åŠ¨å¼ï¼ˆReactiveï¼‰ï¼š</span><br><span class="line">    ç”¨æˆ·è¾“å…¥ â†’ ç³»ç»Ÿå¤„ç† â†’ è¿”å›ç»“æœ</span><br><span class="line">    (åªåšè¢«è¦æ±‚çš„äº‹)</span><br><span class="line"></span><br><span class="line">ä¸»åŠ¨å¼ï¼ˆProactiveï¼‰ï¼š</span><br><span class="line">    ç³»ç»Ÿç›‘æ§ â†’ å‘ç°é—®é¢˜ â†’ ä¸»åŠ¨è§£å†³</span><br><span class="line">    (ä¸»åŠ¨å‘ç°å’Œå¤„ç†é—®é¢˜)</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProactiveAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸»åŠ¨å‹ Agent ç¤ºä¾‹&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">monitor_system_health</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¸»åŠ¨ç›‘æ§ç³»ç»Ÿå¥åº·åº¦&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            health = <span class="variable language_">self</span>.check_system_status()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ä¸»åŠ¨å‘ç°é—®é¢˜</span></span><br><span class="line">            <span class="keyword">if</span> health[<span class="string">&#x27;cpu_usage&#x27;</span>] &gt; <span class="number">80</span>:</span><br><span class="line">                <span class="comment"># ä¸»åŠ¨é‡‡å–è¡ŒåŠ¨ï¼Œè€Œä¸æ˜¯ç­‰å¾…å‘Šè­¦</span></span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.trigger_auto_scaling()</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.notify_admin(<span class="string">&quot;CPU ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå·²è‡ªåŠ¨æ‰©å®¹&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> health[<span class="string">&#x27;memory_usage&#x27;</span>] &gt; <span class="number">85</span>:</span><br><span class="line">                <span class="comment"># ä¸»åŠ¨æ¸…ç†ç¼“å­˜</span></span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.cleanup_cache()</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">self</span>.log_alert(<span class="string">&quot;å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå·²æ¸…ç†ç¼“å­˜&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">await</span> asyncio.sleep(<span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">predict_and_prevent</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é¢„æµ‹é—®é¢˜å¹¶æå‰é˜²æ­¢&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆ†æå†å²æ•°æ®</span></span><br><span class="line">        forecast = <span class="variable language_">self</span>.predict_traffic_spike()</span><br><span class="line">        <span class="keyword">if</span> forecast[<span class="string">&#x27;high_probability&#x27;</span>]:</span><br><span class="line">            <span class="comment"># åœ¨é—®é¢˜å‘ç”Ÿå‰ä¸»åŠ¨æ‰©å®¹</span></span><br><span class="line">            <span class="keyword">await</span> <span class="variable language_">self</span>.prepare_resources(forecast[<span class="string">&#x27;expected_load&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="4-ç¤¾äº¤èƒ½åŠ›ï¼ˆSocial-Abilityï¼‰"><a href="#4-ç¤¾äº¤èƒ½åŠ›ï¼ˆSocial-Abilityï¼‰" class="headerlink" title="4. ç¤¾äº¤èƒ½åŠ›ï¼ˆSocial Abilityï¼‰"></a>4. ç¤¾äº¤èƒ½åŠ›ï¼ˆSocial Abilityï¼‰</h3><p>Agent èƒ½å¤Ÿä¸å…¶ä»– Agentã€ç³»ç»Ÿå’Œç”¨æˆ·è¿›è¡Œæ²Ÿé€šå’Œåä½œã€‚</p>
<p>å¤š Agent åä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Agent 1ï¼ˆæ•°æ®åˆ†æï¼‰â†’ å…±äº«æ•°æ®</span><br><span class="line">Agent 2ï¼ˆå†³ç­–å¼•æ“ï¼‰â†’ å…±äº«çŸ¥è¯†åº“ &amp; èµ„æº</span><br><span class="line">Agent 3ï¼ˆæ‰§è¡Œå¼•æ“ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="Agent-çš„æ¼”è¿›å²"><a href="#Agent-çš„æ¼”è¿›å²" class="headerlink" title="Agent çš„æ¼”è¿›å²"></a>Agent çš„æ¼”è¿›å²</h2><table>
<thead>
<tr>
<th>ä»£æ•°</th>
<th>æ—¶æœŸ</th>
<th>æŠ€æœ¯</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸€ä»£</td>
<td>1970s-1990s</td>
<td>è§„åˆ™å¼•æ“</td>
<td>IF-THEN è§„åˆ™ï¼Œé™æ€å†³ç­–</td>
</tr>
<tr>
<td>äºŒä»£</td>
<td>2000s-2010s</td>
<td>æœºå™¨å­¦ä¹ </td>
<td>ä»æ•°æ®å­¦ä¹ ï¼Œè‡ªé€‚åº”å†³ç­–</td>
</tr>
<tr>
<td>ä¸‰ä»£</td>
<td>2012-2022</td>
<td>æ·±åº¦å­¦ä¹ </td>
<td>ç«¯åˆ°ç«¯å­¦ä¹ ï¼Œéç»“æ„åŒ–æ•°æ®</td>
</tr>
<tr>
<td>å››ä»£</td>
<td>2023-ç°åœ¨</td>
<td>LLM Agent</td>
<td>é€šç”¨æ¨ç†ï¼Œé›¶æ ·æœ¬å­¦ä¹ ï¼Œå·¥å…·è°ƒç”¨</td>
</tr>
</tbody></table>
<h2 id="Agent-çš„åˆ†ç±»"><a href="#Agent-çš„åˆ†ç±»" class="headerlink" title="Agent çš„åˆ†ç±»"></a>Agent çš„åˆ†ç±»</h2><h3 id="æŒ‰å†³ç­–æ–¹å¼"><a href="#æŒ‰å†³ç­–æ–¹å¼" class="headerlink" title="æŒ‰å†³ç­–æ–¹å¼"></a>æŒ‰å†³ç­–æ–¹å¼</h3><ol>
<li><strong>ååº”å¼ Agent</strong> - ç›´æ¥å“åº”è¾“å…¥ï¼Œæ— å†…éƒ¨çŠ¶æ€</li>
<li><strong>å¸¦çŠ¶æ€çš„ Agent</strong> - ç»´æŠ¤å†…éƒ¨çŠ¶æ€ï¼ŒåŸºäºçŠ¶æ€å†³ç­–</li>
<li><strong>è§„åˆ’å¼ Agent</strong> - åˆ¶å®šè®¡åˆ’åæ‰§è¡Œï¼Œæ”¯æŒå¤æ‚å¤šæ­¥éª¤ä»»åŠ¡</li>
</ol>
<h3 id="æŒ‰å­¦ä¹ èƒ½åŠ›"><a href="#æŒ‰å­¦ä¹ èƒ½åŠ›" class="headerlink" title="æŒ‰å­¦ä¹ èƒ½åŠ›"></a>æŒ‰å­¦ä¹ èƒ½åŠ›</h3><ol>
<li><strong>éå­¦ä¹  Agent</strong> - è§„åˆ™å›ºå®šï¼Œä¸æ”¹è¿›</li>
<li><strong>å­¦ä¹  Agent</strong> - ä»æ•°æ®å­¦ä¹ ï¼ŒæŒç»­æ”¹è¿›</li>
</ol>
<h3 id="æŒ‰ä»»åŠ¡ç±»å‹"><a href="#æŒ‰ä»»åŠ¡ç±»å‹" class="headerlink" title="æŒ‰ä»»åŠ¡ç±»å‹"></a>æŒ‰ä»»åŠ¡ç±»å‹</h3><ol>
<li><strong>ä¿¡æ¯æ”¶é›† Agent</strong> - è·å–å’Œæ•´ç†ä¿¡æ¯</li>
<li><strong>å†³ç­–åˆ¶å®š Agent</strong> - åšå‡ºæœ€ä¼˜å†³ç­–</li>
<li><strong>æ‰§è¡Œ Agent</strong> - æ‰§è¡Œå…·ä½“æ“ä½œ</li>
<li><strong>ç›‘æ§ Agent</strong> - æŒç»­ç›‘æ§ç³»ç»ŸçŠ¶æ€</li>
</ol>
<h2 id="Agent-vs-ä¼ ç»Ÿè½¯ä»¶"><a href="#Agent-vs-ä¼ ç»Ÿè½¯ä»¶" class="headerlink" title="Agent vs ä¼ ç»Ÿè½¯ä»¶"></a>Agent vs ä¼ ç»Ÿè½¯ä»¶</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ä¼ ç»Ÿè½¯ä»¶</th>
<th>AI Agent</th>
</tr>
</thead>
<tbody><tr>
<td>ç¼–ç¨‹æ–¹å¼</td>
<td>æ˜¾å¼ç¼–ç é€»è¾‘</td>
<td>é«˜å±‚æ„å›¾æè¿°</td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>æ–°åœºæ™¯é€‚åº”</td>
<td>éœ€è¦é‡æ–°ç¼–ç </td>
<td>è‡ªåŠ¨é€‚åº”</td>
</tr>
<tr>
<td>å­¦ä¹ èƒ½åŠ›</td>
<td>æ— </td>
<td>æœ‰</td>
</tr>
<tr>
<td>å¼€å‘é€Ÿåº¦</td>
<td>æ…¢</td>
<td>å¿«</td>
</tr>
<tr>
<td>è¿è¥æˆæœ¬</td>
<td>ä½</td>
<td>é«˜ï¼ˆæ¨¡å‹æˆæœ¬ï¼‰</td>
</tr>
</tbody></table>
<h3 id="å…·ä½“å¯¹æ¯”ï¼šæ–‡æœ¬åˆ†ç±»"><a href="#å…·ä½“å¯¹æ¯”ï¼šæ–‡æœ¬åˆ†ç±»" class="headerlink" title="å…·ä½“å¯¹æ¯”ï¼šæ–‡æœ¬åˆ†ç±»"></a>å…·ä½“å¯¹æ¯”ï¼šæ–‡æœ¬åˆ†ç±»</h3><p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼šæ‰‹å·¥ç¼–å†™æ‰€æœ‰è§„åˆ™ï¼Œæ–°å¢åˆ†ç±»éœ€è¦ä¿®æ”¹ä»£ç </p>
<p><strong>Agent æ–¹å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç›´æ¥æè¿°ä»»åŠ¡ â†’ æ¨¡å‹è‡ªåŠ¨ç†è§£å’Œåˆ†ç±» â†’ è‡ªåŠ¨å­¦ä¹ æ–°åˆ†ç±»</span><br></pre></td></tr></table></figure>

<h2 id="Agent-åº”ç”¨åœºæ™¯"><a href="#Agent-åº”ç”¨åœºæ™¯" class="headerlink" title="Agent åº”ç”¨åœºæ™¯"></a>Agent åº”ç”¨åœºæ™¯</h2><h3 id="åœºæ™¯-1ï¼šå®¢æˆ·æœåŠ¡"><a href="#åœºæ™¯-1ï¼šå®¢æˆ·æœåŠ¡" class="headerlink" title="åœºæ™¯ 1ï¼šå®¢æˆ·æœåŠ¡"></a>åœºæ™¯ 1ï¼šå®¢æˆ·æœåŠ¡</h3><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>24&#x2F;7 è‡ªåŠ¨å“åº”</li>
<li>å¸¸è§é—®é¢˜è‡ªåŠ¨è§£å†³</li>
<li>æ¯«ç§’çº§å“åº”</li>
<li>æˆæœ¬å¤§å¹…é™ä½</li>
</ul>
<h3 id="åœºæ™¯-2ï¼šå†…å®¹åˆ›ä½œ"><a href="#åœºæ™¯-2ï¼šå†…å®¹åˆ›ä½œ" class="headerlink" title="åœºæ™¯ 2ï¼šå†…å®¹åˆ›ä½œ"></a>åœºæ™¯ 2ï¼šå†…å®¹åˆ›ä½œ</h3><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å¿«é€Ÿç”Ÿæˆåˆç¨¿</li>
<li>å¤šè§’åº¦å†…å®¹ç”Ÿæˆ</li>
<li>å¯å¿«é€Ÿè¿­ä»£</li>
<li>æˆæœ¬ä½</li>
</ul>
<h3 id="åœºæ™¯-3ï¼šæ•°æ®åˆ†æ"><a href="#åœºæ™¯-3ï¼šæ•°æ®åˆ†æ" class="headerlink" title="åœºæ™¯ 3ï¼šæ•°æ®åˆ†æ"></a>åœºæ™¯ 3ï¼šæ•°æ®åˆ†æ</h3><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>éæŠ€æœ¯äººå‘˜å¯ç”¨</li>
<li>å³æ—¶è·å¾—æ´å¯Ÿ</li>
<li>è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š</li>
</ul>
<h3 id="åœºæ™¯-4ï¼šæµç¨‹è‡ªåŠ¨åŒ–"><a href="#åœºæ™¯-4ï¼šæµç¨‹è‡ªåŠ¨åŒ–" class="headerlink" title="åœºæ™¯ 4ï¼šæµç¨‹è‡ªåŠ¨åŒ–"></a>åœºæ™¯ 4ï¼šæµç¨‹è‡ªåŠ¨åŒ–</h3><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨å®¡æ‰¹å·¥ä½œæµ</li>
<li>æ— éœ€äººå·¥å¹²é¢„</li>
<li>æé«˜æ•ˆç‡</li>
</ul>
<hr>
<h1 id="ç¬¬äºŒéƒ¨åˆ†ï¼šAgent-å¼€å‘æ¡†æ¶ï¼ˆADKï¼‰"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šAgent-å¼€å‘æ¡†æ¶ï¼ˆADKï¼‰" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šAgent å¼€å‘æ¡†æ¶ï¼ˆADKï¼‰"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šAgent å¼€å‘æ¡†æ¶ï¼ˆADKï¼‰</h1><h2 id="ADK-æ¡†æ¶æ¦‚è§ˆ"><a href="#ADK-æ¡†æ¶æ¦‚è§ˆ" class="headerlink" title="ADK æ¡†æ¶æ¦‚è§ˆ"></a>ADK æ¡†æ¶æ¦‚è§ˆ</h2><p>Google æä¾›çš„ ADKï¼ˆAgent Development Kitï¼‰æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„ Agent å¼€å‘å·¥å…·åŒ…ï¼Œé‡‡ç”¨å››å±‚æ¶æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  åº”ç”¨å±‚ï¼šä¸šåŠ¡é€»è¾‘å®ç°             â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  ç¼–æ’å±‚ï¼šä»»åŠ¡æµç¨‹å’Œå·¥ä½œæµ         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  èƒ½åŠ›å±‚ï¼šLLMã€å·¥å…·ã€å­˜å‚¨ã€é›†æˆ     â”‚</span><br><span class="line">â”‚  â”œâ”€ LLM æ¨ç†å¼•æ“                â”‚</span><br><span class="line">â”‚  â”œâ”€ å·¥å…·ç®¡ç†ç³»ç»Ÿ                â”‚</span><br><span class="line">â”‚  â”œâ”€ è®°å¿†å­˜å‚¨ç³»ç»Ÿ                â”‚</span><br><span class="line">â”‚  â””â”€ å¤–éƒ¨é›†æˆæ¥å£                â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  åŸºç¡€è®¾æ–½å±‚ï¼šè®¡ç®—ã€å­˜å‚¨ã€ç›‘æ§ã€å®‰å…¨  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="æ¶æ„è®¾è®¡åŸåˆ™"><a href="#æ¶æ„è®¾è®¡åŸåˆ™" class="headerlink" title="æ¶æ„è®¾è®¡åŸåˆ™"></a>æ¶æ„è®¾è®¡åŸåˆ™</h3><ol>
<li><strong>åˆ†å±‚è®¾è®¡</strong> - å„å±‚èŒè´£æ˜ç¡®ï¼Œä¾¿äºç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•</li>
<li><strong>è§£è€¦è®¾è®¡</strong> - ç»„ä»¶é—´æ¾è€¦åˆï¼Œæ”¯æŒæ›¿æ¢å’Œå‡çº§</li>
<li><strong>å¯æ‰©å±•æ€§</strong> - æ”¯æŒæ·»åŠ æ–°å·¥å…·ã€é›†æˆæ–°æ¨¡å‹ã€å®šåˆ¶æµç¨‹</li>
<li><strong>å¯é æ€§</strong> - å®Œå–„çš„é”™è¯¯å¤„ç†ã€é‡è¯•æœºåˆ¶ã€é™çº§ç­–ç•¥</li>
</ol>
<h2 id="æ ¸å¿ƒç»„ä»¶è¯¦è§£"><a href="#æ ¸å¿ƒç»„ä»¶è¯¦è§£" class="headerlink" title="æ ¸å¿ƒç»„ä»¶è¯¦è§£"></a>æ ¸å¿ƒç»„ä»¶è¯¦è§£</h2><h3 id="1-LLM-æ¨ç†å¼•æ“"><a href="#1-LLM-æ¨ç†å¼•æ“" class="headerlink" title="1. LLM æ¨ç†å¼•æ“"></a>1. LLM æ¨ç†å¼•æ“</h3><p><strong>åŠŸèƒ½</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥å¤„ç† â†’ æç¤ºæ„å»º â†’ æ¨¡å‹æ¨ç† â†’ è¾“å‡ºè§£æ â†’ ç»“æœè¿”å›</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®èƒ½åŠ›</strong>ï¼š</p>
<ul>
<li>æç¤ºå·¥ç¨‹</li>
<li>å‡½æ•°è°ƒç”¨</li>
<li>ä¸Šä¸‹æ–‡ç®¡ç†</li>
<li>è¾“å‡ºè§£æ</li>
</ul>
<p><strong>å®Œæ•´å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeminiLLMEngine</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Gemini LLM å¼•æ“å®ç°&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key: <span class="built_in">str</span>, model_name: <span class="built_in">str</span> = <span class="string">&quot;gemini-pro&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.api_key = api_key</span><br><span class="line">        <span class="variable language_">self</span>.model_name = model_name</span><br><span class="line">        <span class="variable language_">self</span>.client = <span class="variable language_">self</span>._init_client()</span><br><span class="line">        <span class="variable language_">self</span>.call_history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_client</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆå§‹åŒ– Gemini å®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line">        genai.configure(api_key=<span class="variable language_">self</span>.api_key)</span><br><span class="line">        <span class="keyword">return</span> genai.GenerativeModel(<span class="variable language_">self</span>.model_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        prompt: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        temperature: <span class="built_in">float</span> = <span class="number">0.7</span>,</span></span><br><span class="line"><span class="params">        max_tokens: <span class="built_in">int</span> = <span class="number">2048</span>,</span></span><br><span class="line"><span class="params">        tools: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">Dict</span>]] = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆå“åº”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            generation_config = &#123;</span><br><span class="line">                <span class="string">&#x27;temperature&#x27;</span>: temperature,</span><br><span class="line">                <span class="string">&#x27;max_output_tokens&#x27;</span>: max_tokens,</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            response = <span class="keyword">await</span> asyncio.to_thread(</span><br><span class="line">                <span class="variable language_">self</span>.client.generate_content,</span><br><span class="line">                prompt,</span><br><span class="line">                generation_config=generation_config</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è®°å½•è°ƒç”¨</span></span><br><span class="line">            <span class="variable language_">self</span>.call_history.append(&#123;</span><br><span class="line">                <span class="string">&#x27;prompt&#x27;</span>: prompt,</span><br><span class="line">                <span class="string">&#x27;response&#x27;</span>: response.text,</span><br><span class="line">                <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;LLM è°ƒç”¨å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_with_function_call</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        prompt: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        tools: <span class="type">List</span>[<span class="type">Dict</span>]</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆå“åº”å¹¶æ”¯æŒå‡½æ•°è°ƒç”¨&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = <span class="keyword">await</span> asyncio.to_thread(</span><br><span class="line">            <span class="variable language_">self</span>.client.generate_content,</span><br><span class="line">            prompt,</span><br><span class="line">            tools=[<span class="variable language_">self</span>._format_tool(tool) <span class="keyword">for</span> tool <span class="keyword">in</span> tools]</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._parse_response(response, tools)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_format_tool</span>(<span class="params">self, tool: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ ¼å¼åŒ–å·¥å…·å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;function&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: tool[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: tool[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;parameters&#x27;</span>: tool.get(<span class="string">&#x27;parameters&#x27;</span>, &#123;&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_response</span>(<span class="params">self, response, tools: <span class="type">List</span>[<span class="type">Dict</span>]</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è§£ææ¨¡å‹å“åº”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(response, <span class="string">&#x27;function_calls&#x27;</span>) <span class="keyword">and</span> response.function_calls:</span><br><span class="line">            function_calls = []</span><br><span class="line">            <span class="keyword">for</span> call <span class="keyword">in</span> response.function_calls:</span><br><span class="line">                function_calls.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;name&#x27;</span>: call.name,</span><br><span class="line">                    <span class="string">&#x27;arguments&#x27;</span>: <span class="built_in">dict</span>(call.args)</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function_call&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;function_calls&#x27;</span>: function_calls,</span><br><span class="line">                <span class="string">&#x27;text&#x27;</span>: response.text</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;text&#x27;</span>: response.text</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¨¡å‹é€‰æ‹©æ ‡å‡†</strong>ï¼š</p>
<ul>
<li>æ¨ç†èƒ½åŠ›</li>
<li>æˆæœ¬æ•ˆç›Šæ¯”</li>
<li>å»¶è¿Ÿè¦æ±‚</li>
<li>Token ä¸Šé™</li>
</ul>
<h3 id="2-å·¥å…·ç®¡ç†ç³»ç»Ÿ"><a href="#2-å·¥å…·ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="2. å·¥å…·ç®¡ç†ç³»ç»Ÿ"></a>2. å·¥å…·ç®¡ç†ç³»ç»Ÿ</h3><p><strong>èŒè´£</strong>ï¼š</p>
<ul>
<li>å·¥å…·æ³¨å†Œå’Œå‘ç°</li>
<li>å·¥å…·è°ƒç”¨æ‰§è¡Œ</li>
<li>ç»“æœå¤„ç†</li>
<li>é”™è¯¯æ¢å¤</li>
</ul>
<p><strong>å®Œæ•´å®ç°</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToolDefinition</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å·¥å…·å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span></span><br><span class="line">    func: <span class="type">Callable</span></span><br><span class="line">    parameters: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span><br><span class="line">    required_params: <span class="type">List</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToolRegistry</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å·¥å…·æ³¨å†Œè¡¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.tools: <span class="type">Dict</span>[<span class="built_in">str</span>, ToolDefinition] = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_tool</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        description: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        required_params: <span class="type">List</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è£…é¥°å™¨ï¼šæ³¨å†Œå·¥å…·&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func: <span class="type">Callable</span></span>):</span><br><span class="line">            sig = inspect.signature(func)</span><br><span class="line">            parameters = &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> param_name, param <span class="keyword">in</span> sig.parameters.items():</span><br><span class="line">                <span class="keyword">if</span> param_name == <span class="string">&#x27;self&#x27;</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                param_type = param.annotation</span><br><span class="line">                <span class="keyword">if</span> param_type == inspect.Parameter.empty:</span><br><span class="line">                    param_type = <span class="string">&#x27;any&#x27;</span></span><br><span class="line">                </span><br><span class="line">                parameters[param_name] = &#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="built_in">str</span>(param_type),</span><br><span class="line">                    <span class="string">&#x27;required&#x27;</span>: param_name <span class="keyword">in</span> (required_params <span class="keyword">or</span> [])</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            tool_def = ToolDefinition(</span><br><span class="line">                name=name,</span><br><span class="line">                description=description,</span><br><span class="line">                func=func,</span><br><span class="line">                parameters=parameters,</span><br><span class="line">                required_params=required_params <span class="keyword">or</span> []</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.tools[name] = tool_def</span><br><span class="line">            <span class="keyword">return</span> func</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> decorator</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">call_tool</span>(<span class="params">self, name: <span class="built_in">str</span>, **kwargs</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è°ƒç”¨å·¥å…·&quot;&quot;&quot;</span></span><br><span class="line">        tool_def = <span class="variable language_">self</span>.tools[name]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># éªŒè¯å‚æ•°</span></span><br><span class="line">        missing_params = [</span><br><span class="line">            p <span class="keyword">for</span> p <span class="keyword">in</span> tool_def.required_params</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">not</span> <span class="keyword">in</span> kwargs</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">if</span> missing_params:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;ç¼ºå°‘å¿…éœ€å‚æ•°: <span class="subst">&#123;missing_params&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è°ƒç”¨å·¥å…·å‡½æ•°</span></span><br><span class="line">        func = tool_def.func</span><br><span class="line">        <span class="keyword">if</span> inspect.iscoroutinefunction(func):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> func(**kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> func(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToolExecutor</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å·¥å…·æ‰§è¡Œå™¨ - è´Ÿè´£å·¥å…·çš„å®‰å…¨æ‰§è¡Œ&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, registry: ToolRegistry, timeout: <span class="built_in">int</span> = <span class="number">30</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.registry = registry</span><br><span class="line">        <span class="variable language_">self</span>.timeout = timeout</span><br><span class="line">        <span class="variable language_">self</span>.execution_log = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute_tool_with_retry</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        tool_name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        max_retries: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">        backoff_factor: <span class="built_in">float</span> = <span class="number">2.0</span>,</span></span><br><span class="line"><span class="params">        **kwargs</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰§è¡Œå·¥å…·ï¼Œæ”¯æŒé‡è¯•&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = <span class="keyword">await</span> asyncio.wait_for(</span><br><span class="line">                    <span class="variable language_">self</span>.registry.call_tool(tool_name, **kwargs),</span><br><span class="line">                    timeout=<span class="variable language_">self</span>.timeout</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">self</span>.execution_log.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;tool&#x27;</span>: tool_name,</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;attempt&#x27;</span>: attempt + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&#x27;result&#x27;</span>: result,</span><br><span class="line">                    <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;result&#x27;</span>: result&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> asyncio.TimeoutError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å·¥å…· <span class="subst">&#123;tool_name&#125;</span> æ‰§è¡Œè¶…æ—¶ (å°è¯• <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>)&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> attempt &lt; max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">await</span> asyncio.sleep(backoff_factor ** attempt)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">                        <span class="string">&#x27;error&#x27;</span>: <span class="string">f&#x27;å·¥å…·æ‰§è¡Œè¶…æ—¶ï¼ˆå·²é‡è¯• <span class="subst">&#123;max_retries&#125;</span> æ¬¡ï¼‰&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å·¥å…· <span class="subst">&#123;tool_name&#125;</span> æ‰§è¡Œå¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.execution_log.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;tool&#x27;</span>: tool_name,</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;attempt&#x27;</span>: attempt + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                    <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> attempt &lt; max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">await</span> asyncio.sleep(backoff_factor ** attempt)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">                        <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                        <span class="string">&#x27;attempts&#x27;</span>: max_retries</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderManagementTools</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¢å•ç®¡ç†å·¥å…·é›†&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, registry: ToolRegistry</span>):</span><br><span class="line">        <span class="variable language_">self</span>.registry = registry</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_tools</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®æ‰€æœ‰å·¥å…·&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.registry.register_tool(</span><br><span class="line">            name=<span class="string">&#x27;get_order_status&#x27;</span>,</span><br><span class="line">            description=<span class="string">&#x27;è·å–è®¢å•çŠ¶æ€&#x27;</span>,</span><br><span class="line">            required_params=[<span class="string">&#x27;order_id&#x27;</span>]</span><br><span class="line">        )(<span class="variable language_">self</span>.get_order_status)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_order_status</span>(<span class="params">self, order_id: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–è®¢å•çŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;order_id&#x27;</span>: order_id,</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;paid&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;items&#x27;</span>: [<span class="string">&#x27;å•†å“1&#x27;</span>, <span class="string">&#x27;å•†å“2&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;total&#x27;</span>: <span class="number">199.99</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><strong>å·¥å…·ç§ç±»</strong>ï¼š</p>
<ul>
<li>API é›†æˆ</li>
<li>æ•°æ®åº“æŸ¥è¯¢</li>
<li>æ–‡ä»¶æ“ä½œ</li>
<li>ç¬¬ä¸‰æ–¹æœåŠ¡</li>
</ul>
<p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å·¥å…·å®šä¹‰æ ‡å‡†åŒ–</li>
<li>å‚æ•°éªŒè¯</li>
<li>æƒé™æ£€æŸ¥</li>
<li>æ‰§è¡Œé‡è¯•</li>
</ul>
<h3 id="3-å†…å­˜ç³»ç»Ÿ"><a href="#3-å†…å­˜ç³»ç»Ÿ" class="headerlink" title="3. å†…å­˜ç³»ç»Ÿ"></a>3. å†…å­˜ç³»ç»Ÿ</h3><p><strong>åˆ†å±‚è®¾è®¡</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å†…å­˜ç±»å‹</th>
<th>ç‰¹ç‚¹</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>ä¼šè¯è®°å¿†</td>
<td>çŸ­æœŸï¼Œå†…å­˜å­˜å‚¨</td>
<td>å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡</td>
</tr>
<tr>
<td>æŒä¹…åŒ–è®°å¿†</td>
<td>é•¿æœŸï¼Œæ•°æ®åº“å­˜å‚¨</td>
<td>ç”¨æˆ·æ¡£æ¡ˆã€å†å²è®°å½•</td>
</tr>
<tr>
<td>çŸ¥è¯†åº“</td>
<td>å‘é‡å­˜å‚¨</td>
<td>ä¸šåŠ¡çŸ¥è¯†ã€å¸¸è§é—®é¢˜</td>
</tr>
</tbody></table>
<p><strong>å®Œæ•´å®ç°</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¶ˆæ¯è®°å½•&quot;&quot;&quot;</span></span><br><span class="line">    role: <span class="built_in">str</span>  <span class="comment"># &#x27;user&#x27; æˆ– &#x27;assistant&#x27;</span></span><br><span class="line">    content: <span class="built_in">str</span></span><br><span class="line">    timestamp: datetime</span><br><span class="line">    metadata: <span class="type">Dict</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SessionMemory</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¼šè¯ï¼ˆçŸ­æœŸï¼‰è®°å¿†&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, session_id: <span class="built_in">str</span>, max_size: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.session_id = session_id</span><br><span class="line">        <span class="variable language_">self</span>.messages: <span class="type">List</span>[Message] = []</span><br><span class="line">        <span class="variable language_">self</span>.max_size = max_size</span><br><span class="line">        <span class="variable language_">self</span>.created_at = datetime.now()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_message</span>(<span class="params">self, role: <span class="built_in">str</span>, content: <span class="built_in">str</span>, metadata: <span class="type">Dict</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ æ¶ˆæ¯&quot;&quot;&quot;</span></span><br><span class="line">        message = Message(</span><br><span class="line">            role=role,</span><br><span class="line">            content=content,</span><br><span class="line">            timestamp=datetime.now(),</span><br><span class="line">            metadata=metadata <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.messages.append(message)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¦‚æœè¶…è¿‡æœ€å¤§æ•°é‡ï¼Œåˆ é™¤æœ€æ—©çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.messages) &gt; <span class="variable language_">self</span>.max_size:</span><br><span class="line">            <span class="variable language_">self</span>.messages.pop(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_context</span>(<span class="params">self, last_n: <span class="built_in">int</span> = <span class="number">10</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–æœ€å N æ¡æ¶ˆæ¯çš„ä¸Šä¸‹æ–‡&quot;&quot;&quot;</span></span><br><span class="line">        recent_messages = <span class="variable language_">self</span>.messages[-last_n:]</span><br><span class="line">        </span><br><span class="line">        context = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> msg <span class="keyword">in</span> recent_messages:</span><br><span class="line">            <span class="keyword">if</span> msg.role == <span class="string">&#x27;user&#x27;</span>:</span><br><span class="line">                context += <span class="string">f&quot;ç”¨æˆ·: <span class="subst">&#123;msg.content&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                context += <span class="string">f&quot;Assistant: <span class="subst">&#123;msg.content&#125;</span>\n&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> context</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_dict</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è½¬æ¢ä¸ºå­—å…¸ï¼ˆç”¨äºåºåˆ—åŒ–ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;session_id&#x27;</span>: <span class="variable language_">self</span>.session_id,</span><br><span class="line">            <span class="string">&#x27;created_at&#x27;</span>: <span class="variable language_">self</span>.created_at.isoformat(),</span><br><span class="line">            <span class="string">&#x27;messages&#x27;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&#x27;role&#x27;</span>: msg.role,</span><br><span class="line">                    <span class="string">&#x27;content&#x27;</span>: msg.content,</span><br><span class="line">                    <span class="string">&#x27;timestamp&#x27;</span>: msg.timestamp.isoformat(),</span><br><span class="line">                    <span class="string">&#x27;metadata&#x27;</span>: msg.metadata</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> msg <span class="keyword">in</span> <span class="variable language_">self</span>.messages</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KnowledgeBase</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;çŸ¥è¯†åº“&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.documents = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.embedder = <span class="variable language_">self</span>._init_embedder()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_embedder</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆå§‹åŒ–æ–‡æœ¬åµŒå…¥æ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># å®é™…åº”è¯¥ä½¿ç”¨çœŸå®çš„åµŒå…¥æ¨¡å‹</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_document</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        doc_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        content: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        metadata: <span class="type">Dict</span> = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ æ–‡æ¡£åˆ°çŸ¥è¯†åº“&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.documents[doc_id] = &#123;</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: content,</span><br><span class="line">            <span class="string">&#x27;created_at&#x27;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&#x27;metadata&#x27;</span>: metadata <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        query: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        top_k: <span class="built_in">int</span> = <span class="number">5</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æœç´¢ç›¸å…³æ–‡æ¡£&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># ç®€å•çš„æ–‡æœ¬åŒ¹é…æœç´¢ï¼ˆå®é™…åº”è¯¥ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼‰</span></span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">for</span> doc_id, doc <span class="keyword">in</span> <span class="variable language_">self</span>.documents.items():</span><br><span class="line">            <span class="keyword">if</span> query.lower() <span class="keyword">in</span> doc[<span class="string">&#x27;content&#x27;</span>].lower():</span><br><span class="line">                results.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;doc_id&#x27;</span>: doc_id,</span><br><span class="line">                    <span class="string">&#x27;content&#x27;</span>: doc[<span class="string">&#x27;content&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;score&#x27;</span>: <span class="number">0.8</span></span><br><span class="line">                &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> results[:top_k]</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¼šè¯è®°å¿†ï¼ˆå†…å­˜ï¼‰ â†’ æŒä¹…åŒ–è®°å¿†ï¼ˆDBï¼‰ â†’ çŸ¥è¯†åº“ï¼ˆå‘é‡DBï¼‰</span><br></pre></td></tr></table></figure>

<h3 id="4-ä»»åŠ¡ç¼–æ’å¼•æ“"><a href="#4-ä»»åŠ¡ç¼–æ’å¼•æ“" class="headerlink" title="4. ä»»åŠ¡ç¼–æ’å¼•æ“"></a>4. ä»»åŠ¡ç¼–æ’å¼•æ“</h3><p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>å·¥ä½œæµå®šä¹‰</li>
<li>ä»»åŠ¡åˆ†é…</li>
<li>çŠ¶æ€ç®¡ç†</li>
<li>ä¾èµ–å¤„ç†</li>
</ul>
<p><strong>å®Œæ•´å®ç°</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Callable</span>, <span class="type">Optional</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskStatus</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»»åŠ¡çŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">    PENDING = <span class="string">&quot;pending&quot;</span></span><br><span class="line">    RUNNING = <span class="string">&quot;running&quot;</span></span><br><span class="line">    SUCCESS = <span class="string">&quot;success&quot;</span></span><br><span class="line">    FAILED = <span class="string">&quot;failed&quot;</span></span><br><span class="line">    RETRYING = <span class="string">&quot;retrying&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»»åŠ¡å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        task_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        action: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        parameters: <span class="type">Dict</span>,</span></span><br><span class="line"><span class="params">        dependencies: <span class="type">List</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="variable language_">self</span>.task_id = task_id</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.action = action</span><br><span class="line">        <span class="variable language_">self</span>.parameters = parameters</span><br><span class="line">        <span class="variable language_">self</span>.dependencies = dependencies <span class="keyword">or</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkflowEngine</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å·¥ä½œæµå¼•æ“&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.tasks: <span class="type">Dict</span>[<span class="built_in">str</span>, Task] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.task_status: <span class="type">Dict</span>[<span class="built_in">str</span>, TaskStatus] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.task_results: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.execution_log = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">define_task</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        task_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        action: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        parameters: <span class="type">Dict</span>,</span></span><br><span class="line"><span class="params">        dependencies: <span class="type">List</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; Task:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å®šä¹‰ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        task = Task(</span><br><span class="line">            task_id=task_id,</span><br><span class="line">            name=name,</span><br><span class="line">            action=action,</span><br><span class="line">            parameters=parameters,</span><br><span class="line">            dependencies=dependencies <span class="keyword">or</span> []</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.tasks[task_id] = task</span><br><span class="line">        <span class="variable language_">self</span>.task_status[task_id] = TaskStatus.PENDING</span><br><span class="line">        <span class="keyword">return</span> task</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute_workflow</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰§è¡Œå·¥ä½œæµ&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ‹“æ‰‘æ’åºï¼šç¡®å®šæ‰§è¡Œé¡ºåº</span></span><br><span class="line">        execution_order = <span class="variable language_">self</span>._topological_sort()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> task_id <span class="keyword">in</span> execution_order:</span><br><span class="line">            task = <span class="variable language_">self</span>.tasks[task_id]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæˆ</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._check_dependencies(task):</span><br><span class="line">                <span class="variable language_">self</span>.task_status[task_id] = TaskStatus.FAILED</span><br><span class="line">                <span class="variable language_">self</span>.execution_log.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;task_id&#x27;</span>: task_id,</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;failed&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;ä¾èµ–ä»»åŠ¡å¤±è´¥&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="variable language_">self</span>.task_status[task_id] = TaskStatus.RUNNING</span><br><span class="line">                </span><br><span class="line">                result = <span class="keyword">await</span> <span class="variable language_">self</span>._execute_task(task)</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">self</span>.task_status[task_id] = TaskStatus.SUCCESS</span><br><span class="line">                <span class="variable language_">self</span>.task_results[task_id] = result</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">self</span>.execution_log.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;task_id&#x27;</span>: task_id,</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;result&#x27;</span>: result</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.task_status[task_id] = TaskStatus.FAILED</span><br><span class="line">                <span class="variable language_">self</span>.execution_log.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;task_id&#x27;</span>: task_id,</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;failed&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">                &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span>: <span class="variable language_">self</span>._get_workflow_status(),</span><br><span class="line">            <span class="string">&#x27;results&#x27;</span>: <span class="variable language_">self</span>.task_results,</span><br><span class="line">            <span class="string">&#x27;log&#x27;</span>: <span class="variable language_">self</span>.execution_log</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_topological_sort</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‹“æ‰‘æ’åºï¼šæŒ‰ä¾èµ–å…³ç³»æ’åºä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        visited = <span class="built_in">set</span>()</span><br><span class="line">        stack = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">visit</span>(<span class="params">task_id</span>):</span><br><span class="line">            <span class="keyword">if</span> task_id <span class="keyword">in</span> visited:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            visited.add(task_id)</span><br><span class="line">            </span><br><span class="line">            task = <span class="variable language_">self</span>.tasks[task_id]</span><br><span class="line">            <span class="keyword">for</span> dep <span class="keyword">in</span> task.dependencies:</span><br><span class="line">                visit(dep)</span><br><span class="line">            </span><br><span class="line">            stack.append(task_id)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> task_id <span class="keyword">in</span> <span class="variable language_">self</span>.tasks:</span><br><span class="line">            visit(task_id)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stack</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_dependencies</span>(<span class="params">self, task: Task</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€æŸ¥ä»»åŠ¡ä¾èµ–æ˜¯å¦å…¨éƒ¨å®Œæˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> dep_id <span class="keyword">in</span> task.dependencies:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.task_status.get(dep_id) != TaskStatus.SUCCESS:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_execute_task</span>(<span class="params">self, task: Task</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰§è¡Œå•ä¸ªä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ‰§è¡Œä»»åŠ¡: <span class="subst">&#123;task.name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)  <span class="comment"># æ¨¡æ‹Ÿæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;task.name&#125;</span> æ‰§è¡Œå®Œæˆ&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_workflow_status</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–å·¥ä½œæµçŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">        statuses = <span class="built_in">set</span>(<span class="variable language_">self</span>.task_status.values())</span><br><span class="line">        <span class="keyword">if</span> TaskStatus.FAILED <span class="keyword">in</span> statuses:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;failed&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> TaskStatus.RUNNING <span class="keyword">in</span> statuses:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;running&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">example_workflow</span>():</span><br><span class="line">    engine = WorkflowEngine()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®šä¹‰å·¥ä½œæµ</span></span><br><span class="line">    engine.define_task(<span class="string">&#x27;task1&#x27;</span>, <span class="string">&#x27;æ•°æ®æ”¶é›†&#x27;</span>, <span class="string">&#x27;collect_data&#x27;</span>, &#123;&#125;)</span><br><span class="line">    engine.define_task(</span><br><span class="line">        <span class="string">&#x27;task2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;æ•°æ®éªŒè¯&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;validate_data&#x27;</span>,</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        dependencies=[<span class="string">&#x27;task1&#x27;</span>]</span><br><span class="line">    )</span><br><span class="line">    engine.define_task(</span><br><span class="line">        <span class="string">&#x27;task3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;æ•°æ®åˆ†æ&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;analyze_data&#x27;</span>,</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        dependencies=[<span class="string">&#x27;task2&#x27;</span>]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ‰§è¡Œå·¥ä½œæµ</span></span><br><span class="line">    result = <span class="keyword">await</span> engine.execute_workflow()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å·¥ä½œæµæ‰§è¡Œç»“æœ:&quot;</span>, result)</span><br></pre></td></tr></table></figure>

<p><strong>æµç¨‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰ä»»åŠ¡ â†’ æ„å»ºä¾èµ–å…³ç³» â†’ æ‹“æ‰‘æ’åº â†’ æŒ‰åºæ‰§è¡Œ â†’ ç»“æœèšåˆ</span><br></pre></td></tr></table></figure>

<h2 id="æç¤ºå·¥ç¨‹æœ€ä½³å®è·µ"><a href="#æç¤ºå·¥ç¨‹æœ€ä½³å®è·µ" class="headerlink" title="æç¤ºå·¥ç¨‹æœ€ä½³å®è·µ"></a>æç¤ºå·¥ç¨‹æœ€ä½³å®è·µ</h2><h3 id="æç¤ºæ¨¡æ¿ç»“æ„"><a href="#æç¤ºæ¨¡æ¿ç»“æ„" class="headerlink" title="æç¤ºæ¨¡æ¿ç»“æ„"></a>æç¤ºæ¨¡æ¿ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. è§’è‰²å®šä¹‰ - &quot;ä½ æ˜¯ä¸€ä¸ª...&quot;</span><br><span class="line">2. ä»»åŠ¡æè¿° - &quot;ä½ éœ€è¦...&quot;</span><br><span class="line">3. ä¸Šä¸‹æ–‡ä¿¡æ¯ - &quot;èƒŒæ™¯æ˜¯...&quot;</span><br><span class="line">4. è¾“å…¥æ•°æ® - &quot;ä»¥ä¸‹æ˜¯...&quot;</span><br><span class="line">5. è¾“å‡ºæ ¼å¼ - &quot;è¯·ä»¥...æ ¼å¼è¾“å‡º&quot;</span><br><span class="line">6. çº¦æŸæ¡ä»¶ - &quot;æ³¨æ„äº‹é¡¹&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–æŠ€å·§"><a href="#ä¼˜åŒ–æŠ€å·§" class="headerlink" title="ä¼˜åŒ–æŠ€å·§"></a>ä¼˜åŒ–æŠ€å·§</h3><ul>
<li><strong>æ˜ç¡®æ€§</strong> - è¯¦ç»†è¯´æ˜ä»»åŠ¡è¦æ±‚</li>
<li><strong>ç»“æ„åŒ–</strong> - ä½¿ç”¨æ¸…æ™°çš„æ ¼å¼å’Œæ®µè½</li>
<li><strong>ç¤ºä¾‹</strong> - æä¾›å…·ä½“ç¤ºä¾‹</li>
<li><strong>çº¦æŸ</strong> - è®¾ç½®æ˜ç¡®çš„é™åˆ¶æ¡ä»¶</li>
</ul>
<h2 id="å·¥å…·ç³»ç»Ÿè®¾è®¡"><a href="#å·¥å…·ç³»ç»Ÿè®¾è®¡" class="headerlink" title="å·¥å…·ç³»ç»Ÿè®¾è®¡"></a>å·¥å…·ç³»ç»Ÿè®¾è®¡</h2><h3 id="å·¥å…·å®šä¹‰è§„èŒƒ"><a href="#å·¥å…·å®šä¹‰è§„èŒƒ" class="headerlink" title="å·¥å…·å®šä¹‰è§„èŒƒ"></a>å·¥å…·å®šä¹‰è§„èŒƒ</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_order_status&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è·å–è®¢å•çŠ¶æ€å’Œè¯¦æƒ…&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;order_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¢å•å·&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;order_id&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="å·¥å…·æ‰§è¡Œæµç¨‹"><a href="#å·¥å…·æ‰§è¡Œæµç¨‹" class="headerlink" title="å·¥å…·æ‰§è¡Œæµç¨‹"></a>å·¥å…·æ‰§è¡Œæµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. å‚æ•°éªŒè¯</span><br><span class="line">2. æƒé™æ£€æŸ¥</span><br><span class="line">3. æ‰§è¡Œå·¥å…·</span><br><span class="line">4. ç»“æœå¤„ç†</span><br><span class="line">5. é”™è¯¯å¤„ç†</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯å¤„ç†ç­–ç•¥"><a href="#é”™è¯¯å¤„ç†ç­–ç•¥" class="headerlink" title="é”™è¯¯å¤„ç†ç­–ç•¥"></a>é”™è¯¯å¤„ç†ç­–ç•¥</h3><ul>
<li><strong>é‡è¯•æœºåˆ¶</strong> - æŒ‡æ•°é€€é¿é‡è¯•</li>
<li><strong>é™çº§æ–¹æ¡ˆ</strong> - ä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ</li>
<li><strong>è¶…æ—¶æ§åˆ¶</strong> - è®¾ç½®åˆç†è¶…æ—¶</li>
<li><strong>æ—¥å¿—è®°å½•</strong> - è¯¦ç»†è®°å½•æ‰€æœ‰æ“ä½œ</li>
</ul>
<h2 id="å†…å­˜ç³»ç»Ÿå®ç°"><a href="#å†…å­˜ç³»ç»Ÿå®ç°" class="headerlink" title="å†…å­˜ç³»ç»Ÿå®ç°"></a>å†…å­˜ç³»ç»Ÿå®ç°</h2><h3 id="ä¼šè¯è®°å¿†"><a href="#ä¼šè¯è®°å¿†" class="headerlink" title="ä¼šè¯è®°å¿†"></a>ä¼šè¯è®°å¿†</h3><p>å­˜å‚¨å½“å‰å¯¹è¯çš„æ¶ˆæ¯å’Œä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹ç‚¹ï¼šæ˜“å¤±æ€§ã€å¿«é€Ÿã€æœ‰é™å®¹é‡</span><br><span class="line">ç”Ÿå‘½å‘¨æœŸï¼šä¼šè¯åˆ›å»ºåˆ°ä¼šè¯ç»“æŸ</span><br></pre></td></tr></table></figure>

<h3 id="æŒä¹…åŒ–è®°å¿†"><a href="#æŒä¹…åŒ–è®°å¿†" class="headerlink" title="æŒä¹…åŒ–è®°å¿†"></a>æŒä¹…åŒ–è®°å¿†</h3><p>å­˜å‚¨ç”¨æˆ·æ¡£æ¡ˆã€å†å²å¯¹è¯ã€å­¦ä¹ ç»“æœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹ç‚¹ï¼šæŒä¹…æ€§ã€æŸ¥è¯¢çµæ´»ã€æ— å®¹é‡é™åˆ¶</span><br><span class="line">æ•°æ®åº“é€‰æ‹©ï¼šPostgreSQLã€MongoDB ç­‰</span><br></pre></td></tr></table></figure>

<h3 id="çŸ¥è¯†åº“"><a href="#çŸ¥è¯†åº“" class="headerlink" title="çŸ¥è¯†åº“"></a>çŸ¥è¯†åº“</h3><p>ä½¿ç”¨å‘é‡æ•°æ®åº“å­˜å‚¨ä¼ä¸šçŸ¥è¯†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹ç‚¹ï¼šé«˜ç»´å‘é‡ã€ç›¸ä¼¼åº¦æœç´¢ã€å¿«é€Ÿæ£€ç´¢</span><br><span class="line">ä½¿ç”¨åœºæ™¯ï¼šFAQã€æ–‡æ¡£æ£€ç´¢ã€çŸ¥è¯†é—®ç­”</span><br></pre></td></tr></table></figure>

<h2 id="å·¥ä½œæµç¼–æ’"><a href="#å·¥ä½œæµç¼–æ’" class="headerlink" title="å·¥ä½œæµç¼–æ’"></a>å·¥ä½œæµç¼–æ’</h2><h3 id="å·¥ä½œæµå®šä¹‰"><a href="#å·¥ä½œæµå®šä¹‰" class="headerlink" title="å·¥ä½œæµå®šä¹‰"></a>å·¥ä½œæµå®šä¹‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»</span></span><br><span class="line">task1 (æ•°æ®æ”¶é›†)</span><br><span class="line">  â†“</span><br><span class="line">task2 (æ•°æ®éªŒè¯) </span><br><span class="line">  â†“</span><br><span class="line">task3 (æ•°æ®åˆ†æ)</span><br><span class="line">  â†“</span><br><span class="line">task4 (æŠ¥å‘Šç”Ÿæˆ)</span><br></pre></td></tr></table></figure>

<h3 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h3><p>ç¡®ä¿ä»»åŠ¡æŒ‰æ­£ç¡®çš„ä¾èµ–å…³ç³»æ‰§è¡Œã€‚</p>
<h3 id="å¹¶è¡Œæ‰§è¡Œ"><a href="#å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="å¹¶è¡Œæ‰§è¡Œ"></a>å¹¶è¡Œæ‰§è¡Œ</h3><p>å½“ä»»åŠ¡æ— ä¾èµ–å…³ç³»æ—¶ï¼Œå¯å¹¶è¡Œæ‰§è¡Œä»¥æé«˜æ•ˆç‡ã€‚</p>
<h3 id="æ•…éšœå¤„ç†"><a href="#æ•…éšœå¤„ç†" class="headerlink" title="æ•…éšœå¤„ç†"></a>æ•…éšœå¤„ç†</h3><ul>
<li>é‡è¯•æœºåˆ¶</li>
<li>å›æ»šç­–ç•¥</li>
<li>éƒ¨åˆ†æˆåŠŸå¤„ç†</li>
</ul>
<hr>
<h1 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿäº§éƒ¨ç½²å’Œæœ€ä½³å®è·µ"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿäº§éƒ¨ç½²å’Œæœ€ä½³å®è·µ" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿäº§éƒ¨ç½²å’Œæœ€ä½³å®è·µ"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿäº§éƒ¨ç½²å’Œæœ€ä½³å®è·µ</h1><h2 id="ç”Ÿäº§çº§-Agent-æ¶æ„"><a href="#ç”Ÿäº§çº§-Agent-æ¶æ„" class="headerlink" title="ç”Ÿäº§çº§ Agent æ¶æ„"></a>ç”Ÿäº§çº§ Agent æ¶æ„</h2><h3 id="å®Œæ•´æ¶æ„è®¾è®¡"><a href="#å®Œæ•´æ¶æ„è®¾è®¡" class="headerlink" title="å®Œæ•´æ¶æ„è®¾è®¡"></a>å®Œæ•´æ¶æ„è®¾è®¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   ç”¨æˆ·å±‚      â”‚  Webã€Appã€APIã€é›†æˆ</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚      ç½‘å…³å±‚ï¼ˆGatewayï¼‰            â”‚</span><br><span class="line">â”‚  è®¤è¯ã€æˆæƒã€é™æµã€è¯·æ±‚éªŒè¯        â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚              â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ Agent ç¼–æ’å±‚  â”‚  â”‚  ç¼“å­˜å±‚      â”‚</span><br><span class="line">â”‚ è´Ÿè½½å‡è¡¡      â”‚  â”‚  Redis      â”‚</span><br><span class="line">â”‚ Agent ç®¡ç†    â”‚  â”‚  Session    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚      Agent å¤„ç†å±‚                  â”‚</span><br><span class="line">â”‚  Agent 1ã€Agent 2ã€...ã€Agent N    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚      èƒ½åŠ›å±‚                        â”‚</span><br><span class="line">â”‚  å·¥å…·åº“ã€å†…å­˜ç³»ç»Ÿã€å®‰å…¨æœåŠ¡         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚      ç›‘æ§å±‚                        â”‚</span><br><span class="line">â”‚  æ—¥å¿—ã€æŒ‡æ ‡ã€é“¾è·¯è¿½è¸ªã€å‘Šè­¦         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="é«˜å¯ç”¨è®¾è®¡"><a href="#é«˜å¯ç”¨è®¾è®¡" class="headerlink" title="é«˜å¯ç”¨è®¾è®¡"></a>é«˜å¯ç”¨è®¾è®¡</h3><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å¤šå®ä¾‹éƒ¨ç½²</li>
<li>è‡ªåŠ¨æ•…éšœè½¬ç§»</li>
<li>å¥åº·æ£€æŸ¥</li>
<li>è‡ªåŠ¨æ¢å¤</li>
</ul>
<p><strong>å®Œæ•´å®ç°</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HighAvailabilityAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é«˜å¯ç”¨ Agent å®ç°&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="type">Dict</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.config = config</span><br><span class="line">        <span class="variable language_">self</span>.instance_id = <span class="variable language_">self</span>._generate_instance_id()</span><br><span class="line">        <span class="variable language_">self</span>.is_healthy = <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.metrics = &#123;</span><br><span class="line">            <span class="string">&#x27;requests_processed&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;requests_failed&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;average_latency&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        request: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>],</span></span><br><span class="line"><span class="params">        timeout: <span class="built_in">int</span> = <span class="number">30</span>,</span></span><br><span class="line"><span class="params">        max_retries: <span class="built_in">int</span> = <span class="number">3</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†è¯·æ±‚&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        start_time = time.time()</span><br><span class="line">        attempt = <span class="number">0</span></span><br><span class="line">        last_error = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> attempt &lt; max_retries:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.is_healthy:</span><br><span class="line">                    <span class="keyword">await</span> <span class="variable language_">self</span>.recover()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line">                result = <span class="keyword">await</span> asyncio.wait_for(</span><br><span class="line">                    <span class="variable language_">self</span>._process_request_internal(request),</span><br><span class="line">                    timeout=timeout</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ›´æ–°æŒ‡æ ‡</span></span><br><span class="line">                latency = time.time() - start_time</span><br><span class="line">                <span class="variable language_">self</span>.metrics[<span class="string">&#x27;requests_processed&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                <span class="variable language_">self</span>.metrics[<span class="string">&#x27;average_latency&#x27;</span>] = (</span><br><span class="line">                    (<span class="variable language_">self</span>.metrics[<span class="string">&#x27;average_latency&#x27;</span>] * (<span class="variable language_">self</span>.metrics[<span class="string">&#x27;requests_processed&#x27;</span>] - <span class="number">1</span>) +</span><br><span class="line">                    latency) / <span class="variable language_">self</span>.metrics[<span class="string">&#x27;requests_processed&#x27;</span>]</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                    <span class="string">&#x27;data&#x27;</span>: result,</span><br><span class="line">                    <span class="string">&#x27;latency&#x27;</span>: latency</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> asyncio.TimeoutError:</span><br><span class="line">                attempt += <span class="number">1</span></span><br><span class="line">                last_error = <span class="string">f&quot;è¯·æ±‚è¶…æ—¶ï¼ˆå°è¯• <span class="subst">&#123;attempt&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>ï¼‰&quot;</span></span><br><span class="line">                <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span> ** attempt)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                attempt += <span class="number">1</span></span><br><span class="line">                last_error = <span class="built_in">str</span>(e)</span><br><span class="line">                <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span> ** attempt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†</span></span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;requests_failed&#x27;</span>] += <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.is_healthy = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&#x27;error&#x27;</span>: last_error,</span><br><span class="line">            <span class="string">&#x27;attempts&#x27;</span>: max_retries</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">health_check</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¥åº·æ£€æŸ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ£€æŸ¥å„ä¸ªç»„ä»¶çš„å¥åº·çŠ¶æ€</span></span><br><span class="line">            <span class="variable language_">self</span>.is_healthy = <span class="keyword">await</span> <span class="variable language_">self</span>._check_all_components()</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.is_healthy</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å¥åº·æ£€æŸ¥å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.is_healthy = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">recover</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ•…éšœæ¢å¤&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¼€å§‹æ¢å¤ Agent <span class="subst">&#123;self.instance_id&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">await</span> <span class="variable language_">self</span>._reinit_connections()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">await</span> <span class="variable language_">self</span>.health_check():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Agent <span class="subst">&#123;self.instance_id&#125;</span> æ¢å¤æˆåŠŸ&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Agent <span class="subst">&#123;self.instance_id&#125;</span> æ¢å¤å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ¢å¤è¿‡ç¨‹å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_instance_id</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆå®ä¾‹ ID&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">import</span> uuid</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_process_request_internal</span>(<span class="params">self, request: <span class="type">Dict</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å®é™…å¤„ç†é€»è¾‘&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_check_all_components</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€æŸ¥æ‰€æœ‰ç»„ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_reinit_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é‡æ–°åˆå§‹åŒ–è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>æ•…éšœè½¬ç§»æµç¨‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸» Agent å¤±è´¥ â†’ å¥åº·æ£€æŸ¥å¤±è´¥ â†’ æµé‡è½¬ç§»åˆ°å¤‡ç”¨ Agent â†’ è‡ªåŠ¨æ¢å¤</span><br></pre></td></tr></table></figure>

<h2 id="å¯è§‚æµ‹æ€§å’Œç›‘æ§"><a href="#å¯è§‚æµ‹æ€§å’Œç›‘æ§" class="headerlink" title="å¯è§‚æµ‹æ€§å’Œç›‘æ§"></a>å¯è§‚æµ‹æ€§å’Œç›‘æ§</h2><h3 id="å…³é”®æŒ‡æ ‡"><a href="#å…³é”®æŒ‡æ ‡" class="headerlink" title="å…³é”®æŒ‡æ ‡"></a>å…³é”®æŒ‡æ ‡</h3><p><strong>1. å»¶è¿ŸæŒ‡æ ‡</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MetricsCollector</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æŒ‡æ ‡æ”¶é›†å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.metrics: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">float</span>]] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.thresholds = &#123;</span><br><span class="line">            <span class="string">&#x27;latency_p99&#x27;</span>: <span class="number">5000</span>,      <span class="comment"># æ¯«ç§’</span></span><br><span class="line">            <span class="string">&#x27;error_rate&#x27;</span>: <span class="number">1</span>,          <span class="comment"># ç™¾åˆ†æ¯”</span></span><br><span class="line">            <span class="string">&#x27;token_usage_ratio&#x27;</span>: <span class="number">0.8</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">record_metric</span>(<span class="params">self, name: <span class="built_in">str</span>, value: <span class="built_in">float</span>, tags: <span class="type">Dict</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®°å½•æŒ‡æ ‡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.metrics:</span><br><span class="line">            <span class="variable language_">self</span>.metrics[name] = []</span><br><span class="line">        <span class="variable language_">self</span>.metrics[name].append(value)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_percentile</span>(<span class="params">self, metric_name: <span class="built_in">str</span>, percentile: <span class="built_in">int</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–æŒ‡æ ‡çš„ç™¾åˆ†ä½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> metric_name <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.metrics:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        values = <span class="built_in">sorted</span>(<span class="variable language_">self</span>.metrics[metric_name])</span><br><span class="line">        index = <span class="built_in">int</span>(<span class="built_in">len</span>(values) * (percentile / <span class="number">100</span>))</span><br><span class="line">        <span class="keyword">return</span> values[index] <span class="keyword">if</span> index &lt; <span class="built_in">len</span>(values) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_threshold_violations</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€æŸ¥é˜ˆå€¼è¿è§„&quot;&quot;&quot;</span></span><br><span class="line">        violations = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> metric_name, threshold <span class="keyword">in</span> <span class="variable language_">self</span>.thresholds.items():</span><br><span class="line">            <span class="keyword">if</span> metric_name <span class="keyword">in</span> <span class="variable language_">self</span>.metrics:</span><br><span class="line">                latest_value = <span class="variable language_">self</span>.metrics[metric_name][-<span class="number">1</span>]</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> latest_value &gt; threshold:</span><br><span class="line">                    violations.append(&#123;</span><br><span class="line">                        <span class="string">&#x27;metric&#x27;</span>: metric_name,</span><br><span class="line">                        <span class="string">&#x27;threshold&#x27;</span>: threshold,</span><br><span class="line">                        <span class="string">&#x27;current_value&#x27;</span>: latest_value,</span><br><span class="line">                        <span class="string">&#x27;severity&#x27;</span>: <span class="variable language_">self</span>._calculate_severity(</span><br><span class="line">                            latest_value, threshold</span><br><span class="line">                        )</span><br><span class="line">                    &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> violations</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_calculate_severity</span>(<span class="params">self, value: <span class="built_in">float</span>, threshold: <span class="built_in">float</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¡ç®—ä¸¥é‡ç¨‹åº¦&quot;&quot;&quot;</span></span><br><span class="line">        ratio = value / threshold</span><br><span class="line">        <span class="keyword">if</span> ratio &gt; <span class="number">1.5</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> ratio &gt; <span class="number">1.2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;high&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;warning&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>P50ã€P95ã€P99 å“åº”æ—¶é—´</li>
<li>å„ç»„ä»¶è€—æ—¶åˆ†æ</li>
</ul>
<p><strong>2. å¯é æ€§æŒ‡æ ‡</strong></p>
<ul>
<li>é”™è¯¯ç‡</li>
<li>æˆåŠŸç‡</li>
<li>é‡è¯•ç‡</li>
</ul>
<p><strong>3. èµ„æºæŒ‡æ ‡</strong></p>
<ul>
<li>CPU ä½¿ç”¨ç‡</li>
<li>å†…å­˜ä½¿ç”¨ç‡</li>
<li>Token ä½¿ç”¨é‡</li>
</ul>
<p><strong>4. ä¸šåŠ¡æŒ‡æ ‡</strong></p>
<ul>
<li>è¯·æ±‚æ•°</li>
<li>è½¬åŒ–ç‡</li>
<li>ç”¨æˆ·æ»¡æ„åº¦</li>
</ul>
<h3 id="ç›‘æ§æ–¹æ¡ˆ"><a href="#ç›‘æ§æ–¹æ¡ˆ" class="headerlink" title="ç›‘æ§æ–¹æ¡ˆ"></a>ç›‘æ§æ–¹æ¡ˆ</h3><p><strong>å®æ—¶ç›‘æ§</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡æ ‡æ”¶é›† â†’ èšåˆ â†’ åˆ†æ â†’ å‘Šè­¦ â†’ è‡ªåŠ¨å“åº”</span><br></pre></td></tr></table></figure>

<p><strong>é“¾è·¯è¿½è¸ª</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ±‚ â†’ ç½‘å…³ â†’ Agent â†’ LLM â†’ å·¥å…· â†’ å“åº”</span><br><span class="line">      â†“      â†“      â†“    â†“    â†“</span><br><span class="line">    æ—¶é—´  æ—¶é—´  æ—¶é—´ æ—¶é—´  æ—¶é—´</span><br></pre></td></tr></table></figure>

<h3 id="å‘Šè­¦ç­–ç•¥"><a href="#å‘Šè­¦ç­–ç•¥" class="headerlink" title="å‘Šè­¦ç­–ç•¥"></a>å‘Šè­¦ç­–ç•¥</h3><ul>
<li><strong>é˜ˆå€¼å‘Šè­¦</strong> - æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼</li>
<li><strong>å¼‚å¸¸æ£€æµ‹</strong> - çªå‘å˜åŒ–å‘Šè­¦</li>
<li><strong>å…³è”å‘Šè­¦</strong> - å¤šæŒ‡æ ‡å…³è”åˆ†æ</li>
</ul>
<h2 id="å®‰å…¨å’Œéšç§"><a href="#å®‰å…¨å’Œéšç§" class="headerlink" title="å®‰å…¨å’Œéšç§"></a>å®‰å…¨å’Œéšç§</h2><h3 id="è®¤è¯å’Œæˆæƒ"><a href="#è®¤è¯å’Œæˆæƒ" class="headerlink" title="è®¤è¯å’Œæˆæƒ"></a>è®¤è¯å’Œæˆæƒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å®‰å…¨ç®¡ç†å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.audit_log = []</span><br><span class="line">        <span class="variable language_">self</span>.rate_limiters = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.blocked_users = <span class="built_in">set</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate_request</span>(<span class="params">self, token: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¤è¯è¯·æ±‚&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># éªŒè¯ token ç­¾å</span></span><br><span class="line">            payload = <span class="variable language_">self</span>._verify_token(token)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">            <span class="keyword">if</span> payload[<span class="string">&#x27;exp&#x27;</span>] &lt; datetime.now().timestamp():</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&#x27;authenticated&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;tokenå·²è¿‡æœŸ&#x27;</span>&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«é™åˆ¶</span></span><br><span class="line">            user_id = payload[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> user_id <span class="keyword">in</span> <span class="variable language_">self</span>.blocked_users:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&#x27;authenticated&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·å·²è¢«é™åˆ¶&#x27;</span>&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;authenticated&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;user_id&#x27;</span>: user_id&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;authenticated&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e)&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authorize_action</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        resource: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        action: <span class="built_in">str</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æˆæƒæ£€æŸ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">&#x27;delete_user&#x27;</span>:</span><br><span class="line">            user_role = <span class="variable language_">self</span>._get_user_role(user_id)</span><br><span class="line">            <span class="keyword">return</span> user_role == <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rate_limit_check</span>(<span class="params">self, user_id: <span class="built_in">str</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é€Ÿç‡é™åˆ¶æ£€æŸ¥&quot;&quot;&quot;</span></span><br><span class="line">        now = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> user_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.rate_limiters:</span><br><span class="line">            <span class="variable language_">self</span>.rate_limiters[user_id] = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ¸…ç†ä¸€åˆ†é’Ÿå¤–çš„è¯·æ±‚</span></span><br><span class="line">        <span class="variable language_">self</span>.rate_limiters[user_id] = [</span><br><span class="line">            req_time <span class="keyword">for</span> req_time <span class="keyword">in</span> <span class="variable language_">self</span>.rate_limiters[user_id]</span><br><span class="line">            <span class="keyword">if</span> now - req_time &lt; <span class="number">60</span></span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.rate_limiters[user_id]) &gt;= limit:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®°å½•æ–°è¯·æ±‚</span></span><br><span class="line">        <span class="variable language_">self</span>.rate_limiters[user_id].append(now)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_audit_event</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        action: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        resource: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        details: <span class="type">Dict</span> = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®°å½•å®¡è®¡æ—¥å¿—&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.audit_log.append(&#123;</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&#x27;user_id&#x27;</span>: user_id,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span>: action,</span><br><span class="line">            <span class="string">&#x27;resource&#x27;</span>: resource,</span><br><span class="line">            <span class="string">&#x27;details&#x27;</span>: details <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_verify_token</span>(<span class="params">self, token: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;éªŒè¯ token&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># å®ç° JWT éªŒè¯é€»è¾‘</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_user_role</span>(<span class="params">self, user_id: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–ç”¨æˆ·è§’è‰²&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. è®¤è¯ - ç¡®è®¤ç”¨æˆ·èº«ä»½ï¼ˆTokenã€OAuthï¼‰</span><br><span class="line">2. æˆæƒ - æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆåŸºäºè§’è‰²ã€åŸºäºèµ„æºï¼‰</span><br><span class="line">3. å®¡è®¡ - è®°å½•æ‰€æœ‰æ“ä½œ</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®å®‰å…¨"><a href="#æ•°æ®å®‰å…¨" class="headerlink" title="æ•°æ®å®‰å…¨"></a>æ•°æ®å®‰å…¨</h3><ul>
<li><strong>åŠ å¯†</strong> - ä¼ è¾“å±‚å’Œå­˜å‚¨å±‚åŠ å¯†</li>
<li><strong>PII æ£€æµ‹</strong> - æ£€æµ‹ä¸ªäººå¯è¯†åˆ«ä¿¡æ¯</li>
<li><strong>åŒ¿ååŒ–</strong> - å¤„ç†æ•æ„Ÿæ•°æ®</li>
</ul>
<h3 id="éšç§åˆè§„"><a href="#éšç§åˆè§„" class="headerlink" title="éšç§åˆè§„"></a>éšç§åˆè§„</h3><ul>
<li><strong>GDPR</strong> - æ•°æ®ä¿ç•™ã€åˆ é™¤æƒåˆ©</li>
<li><strong>CCPA</strong> - æ•°æ®é€æ˜æ€§</li>
<li><strong>æœ¬åœ°æ³•è§„</strong> - ä¾æ®åœ°åŒºæ³•è§„å¤„ç†</li>
</ul>
<h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><h3 id="ç¼“å­˜ç­–ç•¥"><a href="#ç¼“å­˜ç­–ç•¥" class="headerlink" title="ç¼“å­˜ç­–ç•¥"></a>ç¼“å­˜ç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç¼“å­˜ç®¡ç†å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.memory_cache = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.cache_stats = &#123;</span><br><span class="line">            <span class="string">&#x27;hits&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;misses&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;evictions&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.max_memory = <span class="number">100</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 100MB</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–ç¼“å­˜&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.memory_cache:</span><br><span class="line">            <span class="variable language_">self</span>.cache_stats[<span class="string">&#x27;hits&#x27;</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.memory_cache[key][<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.cache_stats[<span class="string">&#x27;misses&#x27;</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">self, key: <span class="built_in">str</span>, value: <span class="type">Any</span>, ttl: <span class="built_in">int</span> = <span class="number">3600</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®ç¼“å­˜&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.memory_cache[key] = &#123;</span><br><span class="line">            <span class="string">&#x27;value&#x27;</span>: value,</span><br><span class="line">            <span class="string">&#x27;expiry&#x27;</span>: time.time() + ttl,</span><br><span class="line">            <span class="string">&#x27;access_count&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;last_accessed&#x27;</span>: time.time()</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cache_result</span>(<span class="params">self, ttl: <span class="built_in">int</span> = <span class="number">3600</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç¼“å­˜è£…é¥°å™¨&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">            @wraps(<span class="params">func</span>)</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">                <span class="comment"># ç”Ÿæˆç¼“å­˜é”®</span></span><br><span class="line">                cache_key = <span class="variable language_">self</span>._generate_cache_key(func.__name__, args, kwargs)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å°è¯•ä»ç¼“å­˜è·å–</span></span><br><span class="line">                cached_value = <span class="variable language_">self</span>.get(cache_key)</span><br><span class="line">                <span class="keyword">if</span> cached_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">return</span> cached_value</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">                result = <span class="keyword">await</span> func(*args, **kwargs)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å­˜å‚¨åˆ°ç¼“å­˜</span></span><br><span class="line">                <span class="variable language_">self</span>.<span class="built_in">set</span>(cache_key, result, ttl)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> wrapper</span><br><span class="line">        <span class="keyword">return</span> decorator</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_cache_key</span>(<span class="params">self, func_name: <span class="built_in">str</span>, args: <span class="built_in">tuple</span>, kwargs: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆç¼“å­˜é”®&quot;&quot;&quot;</span></span><br><span class="line">        key_data = &#123;</span><br><span class="line">            <span class="string">&#x27;func&#x27;</span>: func_name,</span><br><span class="line">            <span class="string">&#x27;args&#x27;</span>: args,</span><br><span class="line">            <span class="string">&#x27;kwargs&#x27;</span>: kwargs</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        key_str = json.dumps(key_data, sort_keys=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(key_str.encode()).hexdigest()</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‰å±‚ç¼“å­˜</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. è¯·æ±‚ç¼“å­˜ - ç›¸åŒè¯·æ±‚çš„ç»“æœ</span><br><span class="line">2. è®¡ç®—ç¼“å­˜ - ä¸­é—´ç»“æœç¼“å­˜</span><br><span class="line">3. çŸ¥è¯†ç¼“å­˜ - çŸ¥è¯†åº“ç¼“å­˜</span><br></pre></td></tr></table></figure>

<p><strong>ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong>ï¼š</p>
<ul>
<li>TTL è¿‡æœŸ</li>
<li>LRU æ·˜æ±°</li>
<li>ä¸»åŠ¨æ›´æ–°</li>
</ul>
<h3 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncTaskQueue</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_workers: <span class="built_in">int</span> = <span class="number">10</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.queue = asyncio.Queue()</span><br><span class="line">        <span class="variable language_">self</span>.max_workers = max_workers</span><br><span class="line">        <span class="variable language_">self</span>.workers = []</span><br><span class="line">        <span class="variable language_">self</span>.results = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¯åŠ¨å·¥ä½œçº¿ç¨‹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.workers = [</span><br><span class="line">            asyncio.create_task(<span class="variable language_">self</span>._worker())</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.max_workers)</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_task</span>(<span class="params">self, task_id: <span class="built_in">str</span>, task: <span class="type">Callable</span>, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.queue.put(&#123;</span><br><span class="line">            <span class="string">&#x27;task_id&#x27;</span>: task_id,</span><br><span class="line">            <span class="string">&#x27;task&#x27;</span>: task,</span><br><span class="line">            <span class="string">&#x27;args&#x27;</span>: args,</span><br><span class="line">            <span class="string">&#x27;kwargs&#x27;</span>: kwargs</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_worker</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å·¥ä½œçº¿ç¨‹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            task_item = <span class="keyword">await</span> <span class="variable language_">self</span>.queue.get()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = <span class="keyword">await</span> task_item[<span class="string">&#x27;task&#x27;</span>](</span><br><span class="line">                    *task_item[<span class="string">&#x27;args&#x27;</span>],</span><br><span class="line">                    **task_item[<span class="string">&#x27;kwargs&#x27;</span>]</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">self</span>.results[task_item[<span class="string">&#x27;task_id&#x27;</span>]] = &#123;</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;result&#x27;</span>: result</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.results[task_item[<span class="string">&#x27;task_id&#x27;</span>]] = &#123;</span><br><span class="line">                    <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;failed&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                <span class="variable language_">self</span>.queue.task_done()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŒæ­¥æ“ä½œï¼šè¯·æ±‚ â†’ å¤„ç† â†’ å“åº”ï¼ˆç­‰å¾…æ—¶é—´é•¿ï¼‰</span><br><span class="line"></span><br><span class="line">å¼‚æ­¥æ“ä½œï¼šè¯·æ±‚ â†’ åŠ å…¥é˜Ÿåˆ— â†’ ç«‹å³å“åº”</span><br><span class="line">                        â”‚</span><br><span class="line">                  åå°å¤„ç† â†’ ç»“æœå›è°ƒ</span><br></pre></td></tr></table></figure>

<h3 id="Token-ä¼˜åŒ–"><a href="#Token-ä¼˜åŒ–" class="headerlink" title="Token ä¼˜åŒ–"></a>Token ä¼˜åŒ–</h3><ul>
<li><strong>æç¤ºå‹ç¼©</strong> - åˆ é™¤ä¸å¿…è¦å†…å®¹</li>
<li><strong>ç¼“å­˜å¤ç”¨</strong> - ç¼“å­˜å¸¸è§æç¤º</li>
<li><strong>æ¨¡å‹é€‰æ‹©</strong> - é€‰æ‹©é«˜æ•ˆçš„æ¨¡å‹</li>
</ul>
<h2 id="éƒ¨ç½²ç­–ç•¥"><a href="#éƒ¨ç½²ç­–ç•¥" class="headerlink" title="éƒ¨ç½²ç­–ç•¥"></a>éƒ¨ç½²ç­–ç•¥</h2><h3 id="åˆ†é˜¶æ®µéƒ¨ç½²"><a href="#åˆ†é˜¶æ®µéƒ¨ç½²" class="headerlink" title="åˆ†é˜¶æ®µéƒ¨ç½²"></a>åˆ†é˜¶æ®µéƒ¨ç½²</h3><p><strong>é‡‘ä¸é›€éƒ¨ç½²</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¼€å‘ â†’ æµ‹è¯• â†’ ç°åº¦ï¼ˆ10%ï¼‰ â†’ å…¨é‡ï¼ˆ100%ï¼‰</span><br><span class="line">                    â†“</span><br><span class="line">              ç›‘æ§æŒ‡æ ‡ â†’ è‡ªåŠ¨å›æ»š</span><br></pre></td></tr></table></figure>

<p><strong>Blue-Green éƒ¨ç½²</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Blueï¼ˆå½“å‰ï¼‰â† æµé‡ â†’ Greenï¼ˆæ–°ç‰ˆæœ¬ï¼‰</span><br><span class="line">                     â†“</span><br><span class="line">                 å®Œæ•´æµ‹è¯•</span><br><span class="line">                     â†“</span><br><span class="line">                  æµé‡åˆ‡æ¢</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²æ£€æŸ¥æ¸…å•"><a href="#éƒ¨ç½²æ£€æŸ¥æ¸…å•" class="headerlink" title="éƒ¨ç½²æ£€æŸ¥æ¸…å•"></a>éƒ¨ç½²æ£€æŸ¥æ¸…å•</h3><ul>
<li><input disabled="" type="checkbox"> åŠŸèƒ½æµ‹è¯•é€šè¿‡</li>
<li><input disabled="" type="checkbox"> æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡</li>
<li><input disabled="" type="checkbox"> å®‰å…¨å®¡æŸ¥å®Œæˆ</li>
<li><input disabled="" type="checkbox"> æ–‡æ¡£å·²æ›´æ–°</li>
<li><input disabled="" type="checkbox"> ç¾å¤‡æ–¹æ¡ˆå·²éªŒè¯</li>
</ul>
<h2 id="æ•…éšœå¤„ç†å’Œæ¢å¤"><a href="#æ•…éšœå¤„ç†å’Œæ¢å¤" class="headerlink" title="æ•…éšœå¤„ç†å’Œæ¢å¤"></a>æ•…éšœå¤„ç†å’Œæ¢å¤</h2><h3 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ£€æµ‹æ•…éšœ â†’ æ ‡è®°ä¸å¥åº· â†’ æµé‡è½¬ç§» â†’ æ¢å¤å°è¯• â†’ å¥åº·æ£€æŸ¥</span><br></pre></td></tr></table></figure>

<h3 id="æ¢å¤æµç¨‹"><a href="#æ¢å¤æµç¨‹" class="headerlink" title="æ¢å¤æµç¨‹"></a>æ¢å¤æµç¨‹</h3><ol>
<li><strong>è‡ªåŠ¨æ¢å¤</strong> - æ¸…ç†çŠ¶æ€ã€é‡æ–°åˆå§‹åŒ–</li>
<li><strong>æ‰‹åŠ¨å¹²é¢„</strong> - äººå·¥ç¡®è®¤åæ¢å¤</li>
<li><strong>éƒ¨åˆ†æ¢å¤</strong> - å…³é—­æ•…éšœæ¨¡å—ï¼Œå…¶ä»–ç»§ç»­è¿è¡Œ</li>
</ol>
<h3 id="é™çº§ç­–ç•¥"><a href="#é™çº§ç­–ç•¥" class="headerlink" title="é™çº§ç­–ç•¥"></a>é™çº§ç­–ç•¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å…¨åŠŸèƒ½ â†’ æ ¸å¿ƒåŠŸèƒ½ â†’ åªè¯»æ¨¡å¼ â†’ ç¦»çº¿æ¨¡å¼</span><br><span class="line">         (é”™è¯¯ç‡é«˜)  (æ•…éšœä¸¥é‡)  (å®Œå…¨ä¸å¯ç”¨)</span><br></pre></td></tr></table></figure>

<h2 id="æˆæœ¬ä¼˜åŒ–"><a href="#æˆæœ¬ä¼˜åŒ–" class="headerlink" title="æˆæœ¬ä¼˜åŒ–"></a>æˆæœ¬ä¼˜åŒ–</h2><h3 id="Token-æˆæœ¬ç®¡ç†"><a href="#Token-æˆæœ¬ç®¡ç†" class="headerlink" title="Token æˆæœ¬ç®¡ç†"></a>Token æˆæœ¬ç®¡ç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç›‘æ§ â†’ ä¼˜åŒ–æç¤º â†’ ä½¿ç”¨ç¼“å­˜ â†’ æ‰¹é‡å¤„ç† â†’ æ¨¡å‹é€‰æ‹©</span><br></pre></td></tr></table></figure>

<p><strong>æˆæœ¬æ§åˆ¶</strong>ï¼š</p>
<ul>
<li>è®¾ç½®æœˆåº¦é¢„ç®—</li>
<li>ç›‘æ§å®æ—¶æ¶ˆè´¹</li>
<li>è‡ªåŠ¨å‘Šè­¦</li>
<li>è§¦å‘é™çº§</li>
</ul>
<h3 id="åŸºç¡€è®¾æ–½æˆæœ¬"><a href="#åŸºç¡€è®¾æ–½æˆæœ¬" class="headerlink" title="åŸºç¡€è®¾æ–½æˆæœ¬"></a>åŸºç¡€è®¾æ–½æˆæœ¬</h3><ul>
<li>ä½¿ç”¨æŒ‰éœ€ä»˜è´¹</li>
<li>è‡ªåŠ¨æ‰©ç¼©å®¹</li>
<li>èµ„æºå…±äº«</li>
<li>é€‰æ‹©æˆæœ¬æ•ˆç›Šæœ€ä¼˜æ–¹æ¡ˆ</li>
</ul>
<hr>
<h1 id="ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹åˆ†æ"><a href="#ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹åˆ†æ" class="headerlink" title="ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹åˆ†æ"></a>ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹åˆ†æ</h1><h2 id="ç”µå•†å®¢æœ-Agent-å®Œæ•´å®ç°"><a href="#ç”µå•†å®¢æœ-Agent-å®Œæ•´å®ç°" class="headerlink" title="ç”µå•†å®¢æœ Agent å®Œæ•´å®ç°"></a>ç”µå•†å®¢æœ Agent å®Œæ•´å®ç°</h2><h3 id="åŠŸèƒ½è®¾è®¡"><a href="#åŠŸèƒ½è®¾è®¡" class="headerlink" title="åŠŸèƒ½è®¾è®¡"></a>åŠŸèƒ½è®¾è®¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è¯¢é—®</span><br><span class="line">  â†“</span><br><span class="line">æ„å›¾ç†è§£ï¼ˆLLMï¼‰</span><br><span class="line">  â†“</span><br><span class="line">â†™         â†“         â†˜</span><br><span class="line">å¸¸è§é—®é¢˜  éœ€è¦æ“ä½œ  éœ€è¦äººå·¥</span><br><span class="line">â”‚         â”‚        â”‚</span><br><span class="line">â”œâ†’ç¼“å­˜å›å¤ â”œâ†’è°ƒç”¨å·¥å…· â”œâ†’è½¬æ¥å®¢æœ</span><br><span class="line">          â””â†’ç”Ÿæˆå›å¤</span><br><span class="line">           â†“</span><br><span class="line">        è¿”å›ç»“æœ</span><br></pre></td></tr></table></figure>

<h3 id="å®Œæ•´ä»£ç å®ç°"><a href="#å®Œæ•´ä»£ç å®ç°" class="headerlink" title="å®Œæ•´ä»£ç å®ç°"></a>å®Œæ•´ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EcommerceCustomerServiceAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”µå•†å®¢æœ Agent&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.llm = GeminiLLMEngine(api_key=<span class="string">&quot;your_api_key&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.tools = OrderManagementTools(ToolRegistry())</span><br><span class="line">        <span class="variable language_">self</span>.memory = &#123;</span><br><span class="line">            <span class="string">&#x27;session&#x27;</span>: SessionMemory(<span class="string">&#x27;default&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;persistent&#x27;</span>: <span class="literal">None</span>  <span class="comment"># è¿æ¥çœŸå®æ•°æ®åº“</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.security = SecurityManager()</span><br><span class="line">        <span class="variable language_">self</span>.metrics = MetricsCollector()</span><br><span class="line">        <span class="variable language_">self</span>.cache = CacheManager()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_customer_inquiry</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        inquiry: <span class="built_in">str</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å®¢æˆ·è¯¢é—®&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        start_time = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è®¤è¯</span></span><br><span class="line">            auth_result = <span class="variable language_">self</span>.security.authenticate_request(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> auth_result[<span class="string">&#x27;authenticated&#x27;</span>]:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;è®¤è¯å¤±è´¥&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é€Ÿç‡é™åˆ¶</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.security.rate_limit_check(user_id):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ¸…ç†è¾“å…¥</span></span><br><span class="line">            clean_inquiry = inquiry.strip()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ£€æŸ¥ç¼“å­˜</span></span><br><span class="line">            cached_response = <span class="variable language_">self</span>.cache.get(<span class="string">f&quot;inquiry:<span class="subst">&#123;clean_inquiry&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> cached_response:</span><br><span class="line">                <span class="variable language_">self</span>.metrics.record_metric(<span class="string">&#x27;cache_hit&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> cached_response</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç”Ÿæˆå›å¤</span></span><br><span class="line">            response = <span class="keyword">await</span> <span class="variable language_">self</span>.llm.generate_with_function_call(</span><br><span class="line">                prompt=<span class="variable language_">self</span>._build_customer_prompt(clean_inquiry),</span><br><span class="line">                tools=<span class="variable language_">self</span>.tools.registry.get_tool_definitions()</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¤„ç†å·¥å…·è°ƒç”¨</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;function_call&#x27;</span>:</span><br><span class="line">                <span class="keyword">for</span> call <span class="keyword">in</span> response[<span class="string">&#x27;function_calls&#x27;</span>]:</span><br><span class="line">                    tool_result = <span class="keyword">await</span> <span class="variable language_">self</span>.tools.executor.execute_tool_with_retry(</span><br><span class="line">                        call[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">                        **call[<span class="string">&#x27;arguments&#x27;</span>]</span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment"># é›†æˆå·¥å…·ç»“æœ</span></span><br><span class="line">                    response[<span class="string">&#x27;text&#x27;</span>] = <span class="keyword">await</span> <span class="variable language_">self</span>._integrate_tool_result(</span><br><span class="line">                        response[<span class="string">&#x27;text&#x27;</span>],</span><br><span class="line">                        tool_result</span><br><span class="line">                    )</span><br><span class="line">            </span><br><span class="line">            final_response = response[<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç¼“å­˜å“åº”</span></span><br><span class="line">            <span class="variable language_">self</span>.cache.<span class="built_in">set</span>(<span class="string">f&quot;inquiry:<span class="subst">&#123;clean_inquiry&#125;</span>&quot;</span>, final_response)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ä¿å­˜åˆ°è®°å¿†</span></span><br><span class="line">            <span class="variable language_">self</span>.memory[<span class="string">&#x27;session&#x27;</span>].add_message(<span class="string">&#x27;user&#x27;</span>, clean_inquiry)</span><br><span class="line">            <span class="variable language_">self</span>.memory[<span class="string">&#x27;session&#x27;</span>].add_message(<span class="string">&#x27;assistant&#x27;</span>, final_response)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è®°å½•æŒ‡æ ‡</span></span><br><span class="line">            latency = time.time() - start_time</span><br><span class="line">            <span class="variable language_">self</span>.metrics.record_metric(<span class="string">&#x27;inquiry_latency&#x27;</span>, latency)</span><br><span class="line">            <span class="variable language_">self</span>.metrics.record_metric(<span class="string">&#x27;successful_responses&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å®¡è®¡æ—¥å¿—</span></span><br><span class="line">            <span class="variable language_">self</span>.security.log_audit_event(</span><br><span class="line">                user_id=user_id,</span><br><span class="line">                action=<span class="string">&#x27;customer_inquiry&#x27;</span>,</span><br><span class="line">                resource=<span class="string">&#x27;customer_service&#x27;</span>,</span><br><span class="line">                details=&#123;<span class="string">&#x27;inquiry&#x27;</span>: clean_inquiry&#125;</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> final_response</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="variable language_">self</span>.metrics.record_metric(<span class="string">&#x27;failed_responses&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;å¤„ç†è¯·æ±‚æ—¶å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_customer_prompt</span>(<span class="params">self, inquiry: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ„å»ºå®¢æˆ·æœåŠ¡æç¤º&quot;&quot;&quot;</span></span><br><span class="line">        context = <span class="variable language_">self</span>.memory[<span class="string">&#x27;session&#x27;</span>].get_context()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœä»£è¡¨ã€‚</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        å®¢æˆ·è¯¢é—®ï¼š<span class="subst">&#123;inquiry&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        å¯¹è¯å†å²ï¼š</span></span><br><span class="line"><span class="string">        <span class="subst">&#123;context&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        è¯·æä¾›ä¸€ä¸ªæœ‰å¸®åŠ©ã€å‹å¥½çš„å›å¤ã€‚</span></span><br><span class="line"><span class="string">        å¦‚æœéœ€è¦è°ƒç”¨å·¥å…·ï¼ˆæŸ¥è¯¢è®¢å•ã€å¤„ç†é€€æ¬¾ç­‰ï¼‰ï¼Œè¯·ä½¿ç”¨å¯ç”¨çš„å·¥å…·ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_integrate_tool_result</span>(<span class="params">self, response: <span class="built_in">str</span>, tool_result: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é›†æˆå·¥å…·ç»“æœåˆ°å›å¤&quot;&quot;&quot;</span></span><br><span class="line">        integrated = <span class="keyword">await</span> <span class="variable language_">self</span>.llm.generate(</span><br><span class="line">            prompt=<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            åŸå§‹å›å¤ï¼š<span class="subst">&#123;response&#125;</span></span></span><br><span class="line"><span class="string">            å·¥å…·ç»“æœï¼š<span class="subst">&#123;json.dumps(tool_result)&#125;</span></span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            è¯·åŸºäºå·¥å…·ç»“æœæ›´æ–°å›å¤ï¼Œä½¿å…¶æ›´åŠ å…·ä½“å’Œæœ‰ç”¨ã€‚</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> integrated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    agent = EcommerceCustomerServiceAgent()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¤„ç†ç”¨æˆ·è¯¢é—®</span></span><br><span class="line">    response = <span class="keyword">await</span> agent.handle_customer_inquiry(</span><br><span class="line">        user_id=<span class="string">&quot;user-123&quot;</span>,</span><br><span class="line">        inquiry=<span class="string">&quot;æˆ‘çš„è®¢å•ä»€ä¹ˆæ—¶å€™å‘è´§ï¼Ÿ&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent å›å¤:&quot;</span>, response)</span><br></pre></td></tr></table></figure>

<h3 id="å·¥å…·å®šä¹‰"><a href="#å·¥å…·å®šä¹‰" class="headerlink" title="å·¥å…·å®šä¹‰"></a>å·¥å…·å®šä¹‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. get_order_status - è·å–è®¢å•çŠ¶æ€</span><br><span class="line">2. process_refund - å¤„ç†é€€æ¬¾</span><br><span class="line">3. check_inventory - æŸ¥è¯¢åº“å­˜</span><br><span class="line">4. create_ticket - åˆ›å»ºå·¥å•</span><br><span class="line">5. send_notification - å‘é€é€šçŸ¥</span><br></pre></td></tr></table></figure>

<h3 id="å¤„ç†æµç¨‹"><a href="#å¤„ç†æµç¨‹" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><ol>
<li><p><strong>ç”¨æˆ·è¾“å…¥å¤„ç†</strong></p>
<ul>
<li>æ¸…ç†è¾“å…¥</li>
<li>æ£€æŸ¥ç¼“å­˜</li>
<li>è®¤è¯æˆæƒ</li>
</ul>
</li>
<li><p><strong>æ„å›¾ç†è§£</strong></p>
<ul>
<li>è°ƒç”¨ LLM ç†è§£æ„å›¾</li>
<li>æå–å…³é”®ä¿¡æ¯</li>
<li>åˆ¤æ–­æ‰€éœ€æ“ä½œ</li>
</ul>
</li>
<li><p><strong>å·¥å…·è°ƒç”¨</strong></p>
<ul>
<li>ç¡®å®šæ‰€éœ€å·¥å…·</li>
<li>å‚æ•°éªŒè¯</li>
<li>æ‰§è¡Œå·¥å…·</li>
<li>ç»“æœå¤„ç†</li>
</ul>
</li>
<li><p><strong>å“åº”ç”Ÿæˆ</strong></p>
<ul>
<li>æ•´åˆå·¥å…·ç»“æœ</li>
<li>ç”Ÿæˆè‡ªç„¶è¯­è¨€</li>
<li>æ ¼å¼åŒ–è¾“å‡º</li>
</ul>
</li>
<li><p><strong>åé¦ˆä¿å­˜</strong></p>
<ul>
<li>æ›´æ–°ä¼šè¯è®°å¿†</li>
<li>ä¿å­˜æŒä¹…åŒ–æ•°æ®</li>
<li>è®°å½•å®¡è®¡æ—¥å¿—</li>
</ul>
</li>
</ol>
<h3 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h3><ul>
<li><strong>å“åº”æ—¶é—´</strong> P99 &lt; 2s</li>
<li><strong>æˆåŠŸç‡</strong> &gt; 95%</li>
<li><strong>è‡ªåŠ¨è§£å†³ç‡</strong> &gt; 70%</li>
<li><strong>ç”¨æˆ·æ»¡æ„åº¦</strong> &gt; 4.5&#x2F;5</li>
</ul>
<hr>
<h1 id="æ€»ç»“å’Œå±•æœ›"><a href="#æ€»ç»“å’Œå±•æœ›" class="headerlink" title="æ€»ç»“å’Œå±•æœ›"></a>æ€»ç»“å’Œå±•æœ›</h1><h2 id="å…³é”®è¦ç‚¹æ€»ç»“"><a href="#å…³é”®è¦ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®è¦ç‚¹æ€»ç»“"></a>å…³é”®è¦ç‚¹æ€»ç»“</h2><p>âœ… <strong>AI Agent æ˜¯è‡ªä¸»ã€æ™ºèƒ½çš„è½¯ä»¶ç³»ç»Ÿ</strong><br>âœ… <strong>ADK å››å±‚æ¶æ„æä¾›äº†å®Œæ•´çš„å¼€å‘æ¡†æ¶</strong><br>âœ… <strong>ç”Ÿäº§éƒ¨ç½²éœ€è¦å®Œå–„çš„æ¶æ„è®¾è®¡</strong><br>âœ… <strong>ç›‘æ§ã€å®‰å…¨ã€æˆæœ¬æ˜¯ç”Ÿäº§ç³»ç»Ÿçš„é‡è¦è€ƒé‡</strong><br>âœ… <strong>æŒç»­ä¼˜åŒ–æ˜¯ä¿æŒç«äº‰åŠ›çš„å…³é”®</strong>  </p>
<h2 id="å­¦ä¹ è·¯å¾„å»ºè®®"><a href="#å­¦ä¹ è·¯å¾„å»ºè®®" class="headerlink" title="å­¦ä¹ è·¯å¾„å»ºè®®"></a>å­¦ä¹ è·¯å¾„å»ºè®®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1ï¸âƒ£  ç†è§£ Agent åŸºæœ¬æ¦‚å¿µ</span><br><span class="line">    â†“</span><br><span class="line">2ï¸âƒ£  å­¦ä¹  ADK æ¶æ„å’Œç»„ä»¶</span><br><span class="line">    â†“</span><br><span class="line">3ï¸âƒ£  æŒæ¡æç¤ºå·¥ç¨‹å’Œå·¥å…·ä½¿ç”¨</span><br><span class="line">    â†“</span><br><span class="line">4ï¸âƒ£  å®ç°ä¸€ä¸ªç®€å•çš„ Agent</span><br><span class="line">    â†“</span><br><span class="line">5ï¸âƒ£  ä¼˜åŒ–æ€§èƒ½å’Œæˆæœ¬</span><br><span class="line">    â†“</span><br><span class="line">6ï¸âƒ£  éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</span><br><span class="line">    â†“</span><br><span class="line">7ï¸âƒ£  ç›‘æ§å’ŒæŒç»­æ”¹è¿›</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‹ä¸€æ­¥è¡ŒåŠ¨"><a href="#ä¸‹ä¸€æ­¥è¡ŒåŠ¨" class="headerlink" title="ä¸‹ä¸€æ­¥è¡ŒåŠ¨"></a>ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h2><h3 id="ç«‹å³å¯åš"><a href="#ç«‹å³å¯åš" class="headerlink" title="ç«‹å³å¯åš"></a>ç«‹å³å¯åš</h3><ul>
<li>é˜…è¯» Google å®˜æ–¹ç™½çš®ä¹¦</li>
<li>å®éªŒ LLM APIï¼ˆGeminiã€GPTï¼‰</li>
<li>å°è¯•æ„å»ºç®€å• Agent</li>
<li>äº†è§£å·¥å…·è°ƒç”¨æœºåˆ¶</li>
</ul>
<h3 id="çŸ­æœŸç›®æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰"><a href="#çŸ­æœŸç›®æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰" class="headerlink" title="çŸ­æœŸç›®æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰"></a>çŸ­æœŸç›®æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰</h3><ul>
<li>å®ç°å®Œæ•´çš„ Agent ç³»ç»Ÿ</li>
<li>é›†æˆå¤šä¸ªå·¥å…·</li>
<li>éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ</li>
<li>è¿›è¡Œæ€§èƒ½æµ‹è¯•</li>
</ul>
<h3 id="é•¿æœŸç›®æ ‡ï¼ˆ3-12ä¸ªæœˆï¼‰"><a href="#é•¿æœŸç›®æ ‡ï¼ˆ3-12ä¸ªæœˆï¼‰" class="headerlink" title="é•¿æœŸç›®æ ‡ï¼ˆ3-12ä¸ªæœˆï¼‰"></a>é•¿æœŸç›®æ ‡ï¼ˆ3-12ä¸ªæœˆï¼‰</h3><ul>
<li>ä¼˜åŒ–å’Œè°ƒä¼˜</li>
<li>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</li>
<li>æŒç»­ç›‘æ§æ”¹è¿›</li>
<li>æ‰©å±•åˆ°å¤šä¸ªä¸šåŠ¡åœºæ™¯</li>
</ul>
<hr>
<h2 id="å…³é”®èµ„æº"><a href="#å…³é”®èµ„æº" class="headerlink" title="å…³é”®èµ„æº"></a>å…³é”®èµ„æº</h2><ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong> - <a target="_blank" rel="noopener" href="https://services.google.com/fh/files/misc/startup_technical_guide_ai_agents_final.pdf">Google AI Agents Guide</a></li>
<li><strong>æ¡†æ¶é€‰æ‹©</strong> - Langchainã€AutoGenã€CrewAI</li>
<li><strong>æ¨¡å‹é€‰æ‹©</strong> - Geminiã€GPT-4ã€Claude</li>
<li><strong>å‘é‡æ•°æ®åº“</strong> - Pineconeã€Weaviateã€Milvus</li>
<li><strong>ç›‘æ§å·¥å…·</strong> - Datadogã€New Relicã€Prometheus</li>
</ul>
<hr>
<p><em>ç¥ä½ åœ¨ AI Agent å¼€å‘ä¸­å–å¾—æˆåŠŸï¼è¿™æ˜¯ä¸€ä¸ªå……æ»¡æœºé‡çš„æ–°é¢†åŸŸã€‚</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">RickDamon</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://rickdamon.github.io/2026/01/03/%E5%9F%BA%E4%BA%8Egoogle%E6%9C%80%E6%96%B0agents%E8%AE%BA%E6%96%87%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/">https://rickdamon.github.io/2026/01/03/%E5%9F%BA%E4%BA%8Egoogle%E6%9C%80%E6%96%B0agents%E8%AE%BA%E6%96%87%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">RickDamon</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/AI-Agents/">
                                    <span class="chip bg-color">AI Agents</span>
                                </a>
                            
                                <a href="/tags/LLM/">
                                    <span class="chip bg-color">LLM</span>
                                </a>
                            
                                <a href="/tags/ADK%E6%A1%86%E6%9E%B6/">
                                    <span class="chip bg-color">ADKæ¡†æ¶</span>
                                </a>
                            
                                <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">
                                    <span class="chip bg-color">ç³»ç»Ÿè®¾è®¡</span>
                                </a>
                            
                                <a href="/tags/%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2/">
                                    <span class="chip bg-color">ç”Ÿäº§éƒ¨ç½²</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;æœ¬ç¯‡
            </div>
            <div class="card">
                <a href="/2026/01/03/%E5%9F%BA%E4%BA%8Egoogle%E6%9C%80%E6%96%B0agents%E8%AE%BA%E6%96%87%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="åŸºäºGoogleæœ€æ–°Agentsè®ºæ–‡çš„å­¦ä¹ æ–‡æ¡£">
                        
                        <span class="card-title">åŸºäºGoogleæœ€æ–°Agentsè®ºæ–‡çš„å­¦ä¹ æ–‡æ¡£</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            å¯¼è¯­åŸé“¾æ¥ï¼šGoogle AI Agents Technical Guide
è¿™ä»½ç™½çš®ä¹¦æ˜¯ Google å¯¹AI Agent ä»æ¦‚å¿µåˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŠ€æœ¯è·¯çº¿å›¾ï¼Œæ¶µç›–äº†ï¼š

âœ… AI Agent çš„å®šä¹‰å’Œåˆ†ç±»
âœ… Agent å¼€å‘æ¡†æ¶ï¼ˆADK
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2026-01-03
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/AI/" class="post-category">
                                    AI
                                </a>
                            
                            <a href="/categories/AI/Agent/" class="post-category">
                                    Agent
                                </a>
                            
                            <a href="/categories/AI/Agent/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" class="post-category">
                                    æ¶æ„è®¾è®¡
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/AI-Agents/">
                        <span class="chip bg-color">AI Agents</span>
                    </a>
                    
                    <a href="/tags/LLM/">
                        <span class="chip bg-color">LLM</span>
                    </a>
                    
                    <a href="/tags/ADK%E6%A1%86%E6%9E%B6/">
                        <span class="chip bg-color">ADKæ¡†æ¶</span>
                    </a>
                    
                    <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">
                        <span class="chip bg-color">ç³»ç»Ÿè®¾è®¡</span>
                    </a>
                    
                    <a href="/tags/%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2/">
                        <span class="chip bg-color">ç”Ÿäº§éƒ¨ç½²</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/10/18/Golang1.22%E9%9D%9E%E5%85%BC%E5%AE%B9%E6%80%A7%E6%9B%B4%E6%96%B0%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="Golang1.22éå…¼å®¹æ€§æ›´æ–°è¸©å‘è®°å½•">
                        
                        <span class="card-title">Golang1.22éå…¼å®¹æ€§æ›´æ–°è¸©å‘è®°å½•</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            å¯¼è¯­å‘çš„å†…å®¹ä¸»è¦æ˜¯golangåœ¨1.22ç‰ˆæœ¬ä¸­æ›´æ–°äº†å¾ªç¯ä¸­çš„ä¸´æ—¶å˜é‡ï¼Œæ¯æ¬¡å¾ªç¯ä¸ºå•ç‹¬çš„åœ°å€ï¼Œè€Œåœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰å¾ªç¯ä¸­çš„ä¸´æ—¶å˜é‡ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜ã€‚è¯´çš„æ›´è¯¦ç»†ç‚¹ï¼šåœ¨ Go 1.22 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œfor _, p := range arr 
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-10-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Go/" class="post-category">
                                    Go
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Go/">
                        <span class="chip bg-color">Go</span>
                    </a>
                    
                    <a href="/tags/Go1-22/">
                        <span class="chip bg-color">Go1.22</span>
                    </a>
                    
                    <a href="/tags/%E5%BE%AA%E7%8E%AF%E5%8F%98%E9%87%8F/">
                        <span class="chip bg-color">å¾ªç¯å˜é‡</span>
                    </a>
                    
                    <a href="/tags/%E6%8C%87%E9%92%88/">
                        <span class="chip bg-color">æŒ‡é’ˆ</span>
                    </a>
                    
                    <a href="/tags/%E9%9D%9E%E5%85%BC%E5%AE%B9%E6%80%A7%E6%9B%B4%E6%96%B0/">
                        <span class="chip bg-color">éå…¼å®¹æ€§æ›´æ–°</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2026</span>
            
            <a href="/about" target="_blank">RickDamon</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/rickdamon" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:719196134@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=719196134" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 719196134" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="https://music.163.com/#/artist?id=12662548" class="tooltipped" target="_blank" data-tooltip="å¬å¬æˆ‘çš„éŸ³ä¹" data-position="top" data-delay="50">
        <i class="fas fa-music"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- ç™½å¤©å’Œé»‘å¤œä¸»é¢˜ -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

    <!-- é¼ æ ‡æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
